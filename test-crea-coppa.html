<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Test - Crea la tua Coppa</title>
<style>
    body{font-family: system-ui, sans-serif; background:#FFF6E9; color:#333; padding:20px;}
    header h1{margin:0 0 10px 0; text-align:center; color:#8B6B4A;}
    #top-status{position:fixed; top:12px; right:12px; background:#E8DCC8; color:#8B6B4A; padding:8px 12px; border-radius:10px; font-weight:700; z-index:999;}
    section{max-width:720px; margin:70px auto 20px; background:transparent;}
    .menu-item.option{padding:12px; margin:10px 0; border-radius:10px; background:#fff; border:1px solid rgba(0,0,0,0.06); position:relative; cursor:pointer; transition:.18s;}
    .menu-item.option:hover{transform:translateY(-2px);}
    .option.selected{border:2px solid #28a745; background:#eaffea;}
    .option.selected::after{content:"✔"; position:absolute; right:12px; top:50%; transform:translateY(-50%); color:#28a745; font-weight:700;}
    .option.error{border:2px solid #ff4747; background:#ffe1e1;}
    .option.error::after{content:"✖"; position:absolute; right:12px; top:50%; transform:translateY(-50%); color:#ff3d3d; font-weight:700;}
    .btn{display:inline-block; background:#E8DCC8; color:#8B6B4A; padding:10px 16px; border-radius:10px; text-decoration:none; font-weight:700; margin:8px 6px 0 0; border:2px solid #DAB777; cursor:pointer;}
    .btn-back{background:#c0bebe !important;}
    #alert{color:#b00020; font-weight:700; margin:8px 0;}
    h2{color:#8B6B4A; margin:6px 0 12px 0;}
    /* mobile friendliness */
    @media (max-width:520px){ section{padding:0 12px;} .menu-item.option{font-size:16px;} .btn{width:48%; text-align:center;} }
</style>
</head>
<body>
<header><h1>CREA LA TUA COPPA - TEST</h1></header>
<div id="top-status" aria-hidden="true"></div>

<section id="step-size">
    <h2>Scegli il Formato</h2>
    <div class="menu-item option" data-value="PICCOLA" onclick="selectSize('PICCOLA',2,1,1,1)">PICCOLA (2 gusti)</div>
    <div class="menu-item option" data-value="MEDIA" onclick="selectSize('MEDIA',3,2,2,1)">MEDIA (3 gusti)</div>
    <div class="menu-item option" data-value="GRANDE" onclick="selectSize('GRANDE',4,2,2,2)">GRANDE (4 gusti)</div>
</section>

<section id="step-container"></section>

<script>
// debug
console.log("TEST-CREACOPPA script running");

// Data lists
const gusti = ["VANIGLIA","FIOR DI LATTE","CIOCCOLATO","NOCCIOLA","FRAGOLA","PISTACCHIO","LIMONE"];
const granelle = ["NOCCIOLA","CROCCANTE","PISTACCHIO","SCAGLIETTE"];
const topping = ["NUTELLA","CARAMELLO","SCIROPPO AMARENA","Panna"];
const ingredienti = ["AMARENE","BANANA","FRAGOLE","BISCOTTO"];

let step = 0;
let max = {};
let scelta = { formato:"", gusti:[], granelle:[], topping:[], ingredienti:[] };

function selectSize(nome,g,gra,top,ing){
    console.log("selectSize called", nome);
    scelta.formato = nome;
    max = { gusti:g, granelle:gra, topping:top, ingredienti:ing };
    step = 1;
    const s = document.getElementById('step-size'); if(s) s.style.display='none';
    showStep();
    updateStatus();
}

function updateStatus(){
    const st = document.getElementById('top-status');
    if(!st) return;
    let label = "";
    if(step===1) label = `GUSTI (${scelta.gusti.length}/${max.gusti})`;
    if(step===2) label = `GRANELLE (${scelta.granelle.length}/${max.granelle})`;
    if(step===3) label = `TOPPING (${scelta.topping.length}/${max.topping})`;
    if(step===4) label = `EXTRA (${scelta.ingredienti.length}/${max.ingredienti})`;
    if(step>4) label = "RIEPILOGO";
    st.textContent = `${scelta.formato} | ${label}`;
}

function toggle(tipo,item,elem){
    console.log("toggle", tipo, item);
    const arr = scelta[tipo];
    const alertBox = document.getElementById('alert');
    if(arr.includes(item)){
        scelta[tipo] = arr.filter(x=>x!==item);
        elem.classList.remove('selected','error');
        if(alertBox) alertBox.textContent = "";
    } else {
        if(arr.length >= max[tipo]){
            elem.classList.add('error');
            if(alertBox) alertBox.textContent = "❌ Limite raggiunto!";
            return;
        }
        arr.push(item);
        elem.classList.add('selected'); elem.classList.remove('error');
        if(alertBox) alertBox.textContent = "";
    }
    updateStatus();
    // auto-advance if filled
    if(scelta[tipo].length === max[tipo]){
        setTimeout(()=>{ nextStep(); }, 350);
    }
}

function showStep(){
    console.log("showStep", step);
    const container = document.getElementById('step-container');
    container.innerHTML = '';
    const map = [
        ["SCEGLI I GUSTI", gusti, "gusti"],
        ["SCEGLI LE GRANELLE", granelle, "granelle"],
        ["SCEGLI I TOPPING", topping, "topping"],
        ["SCEGLI GLI INGREDIENTI EXTRA", ingredienti, "ingredienti"]
    ];
    if(step<=4){
        const [title, list, key] = map[step-1];
        container.innerHTML = `<h2>${title}</h2><div id="alert"></div>`;
        list.forEach(it=>{
            const d = document.createElement('div');
            d.className = 'menu-item option';
            d.textContent = it;
            d.onclick = ()=> toggle(key, it, d);
            container.appendChild(d);
        });
        const back = document.createElement('a'); back.className='btn btn-back'; back.textContent='Indietro'; back.onclick=prevStep;
        const next = document.createElement('a'); next.className='btn'; next.textContent='Avanti'; next.onclick=nextStep;
        container.appendChild(next); container.appendChild(back);
        updateStatus();
        return;
    }
    // summary
    container.innerHTML = `<h2>RIEPILOGO</h2>
        <p>Formato: ${scelta.formato}</p>
        <p>Gusti: ${scelta.gusti.join(", ")}</p>
        <p>Granelle: ${scelta.granelle.join(", ")}</p>
        <p>Topping: ${scelta.topping.join(", ")}</p>
        <p>Extra: ${scelta.ingredienti.join(", ")}</p>
        <a class="btn" href="#">Mostra al cameriere</a>`;
}

// navigation
function nextStep(){ step++; showStep(); }
function prevStep(){ if(step>1) step--; showStep(); }

</script>
</body>
</html>