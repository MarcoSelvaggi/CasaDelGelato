<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>Casa del Gelato</title>
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="icon" href="favicon.png">
  <link rel="apple-touch-icon" href="icon-192.png">
  <script src="global.js"></script>


  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;margin:0;background:#f6f6f7;color:#111}
    header{text-align:center;padding:22px}

    /* Spazio sotto per non schiacciare la bottom bar */
body {
    padding-bottom: 90px;
}
/* Protezione icone bottom nav */
#bottom-nav img {
    width: 26px !important;
    height: 26px !important;
    object-fit: contain !important;
}
    /* üîù BARRA FISSA + HOME */
    #top-fixed-bar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 55px;
      display: flex;
      justify-content: center;
      align-items: center;
      background: white;
      border-bottom: 1px solid #ddd;
      z-index: 9999;
    }

    .home-btn {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 17px;
        color: #444;
        text-decoration: none;
    }

    .home-btn img {
        width: 28px;
        height: 28px;
    }

    /* spazio per far scendere il contenuto */
    #top-fixed-spacer {
      height: 55px;
      width: 100%;
    }
    /* Tasto Lavora con Noi (solo in index) */
.jobs-btn {
    position: absolute;
    left: 12px;
    top: 13px;
    padding: 6px 10px;
    background: #ff7a00;
    color: white;
    font-size: 14px;
    border-radius: 10px;
    text-decoration: none;
    font-weight: 600;
    z-index: 9999;
}

    /* LANGUAGE MENU */
    #lang-toggle{
      position:fixed; 
      top:14px; 
      right:14px;
      padding:6px 12px;
      border-radius:12px;
      background:white;
      border:1px solid #ddd;
      cursor:pointer; 
      font-size:18px;
      z-index:10000;
    }

#lang-menu{
  position: fixed;
  top: 54px;
  right: 14px;

  background: #fff;
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0,0,0,.25);

  min-width: 140px;

  opacity: 0;
  transform: translateY(-6px);
  pointer-events: none;

  transition: opacity .2s ease, transform .2s ease;

  z-index: 10002;
}

#lang-menu.open{
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}
    #lang-menu button{
      padding:10px 16px;
      border:none;
      background:transparent;
      cursor:pointer;
      font-size:15px;
      text-align:left;
      width:100%;
    }

    #lang-menu button:hover{background:#f2f2f2;}

    /* BUTTONS */
    .menu-section{padding:22px;text-align:center}
    .btn{
      display:block;width:240px;text-align:center;
      padding:12px 14px;border-radius:12px;background:#ff7a00;color:#fff;
      text-decoration:none;margin:14px auto;font-size:17px;font-weight:600;
    }

    /* CARDS */
    .shop-card {
      background:white;
      padding:16px;
      border-radius:14px;
      margin:14px auto;
      max-width:330px;
      box-shadow:0 2px 6px rgba(0,0,0,0.08);
      text-align:left;
    }
    .shop-card b {font-size:16px;margin-bottom:4px;display:block;}
    .shop-card a {text-decoration:none;margin-top:4px;display:block;font-size:15px;color:#007aff;}

/* ‚ò∞ MENU DROPDOWN */
#menu-dropdown a{
  display:block;
  padding:10px;
  border-radius:10px;
  text-decoration:none;
  color:#111;
  font-size:15px;
  font-weight:600; /* üî• COME INFO & CONTATTI */
}

#menu-dropdown a:hover{
  background:#f2f2f7;
}

.menu-item {
  display: flex !important;
  flex-direction: row !important;
  align-items: center !important;
  gap: 12px;
}

.menu-item svg.menu-icon {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
  stroke: #111;
  stroke-width: 1.8;
  fill: none;
  display: block; 

}
.icon-wrapper{
  position: relative;
  display: inline-flex;
  align-items: center;
}

.menu-new-only{
  display: flex;
  align-items: center;
  gap: 12px;
}

.badge-new-left{
  background: #ff3b30;
  color: #fff;
  font-size: 9px;          /* ‚¨ÖÔ∏è pi√π piccolo */
  font-weight: 700;
  padding: 3px 6px;        /* ‚¨ÖÔ∏è meno padding */
  border-radius: 999px;
  line-height: 1;
  letter-spacing: .3px;
}


/* ===============================
   ‚è±Ô∏è WAIT BAR ‚Äì DIMENSIONI BLOCCATE
=============================== */

#wait-bar {
  /* üîí isolamento totale */
  all: unset;
  box-sizing: border-box;

  position: fixed;
  bottom: 90px;
  left: 12px;

  display: none;
  align-items: center;
  justify-content: center;

  background: #111;
  color: #fff;

  /* üî¢ dimensioni IDENTICHE a crea coppa */
  font-family: -apple-system, BlinkMacSystemFont,
               "SF Pro Text", "SF Pro Display",
               system-ui, sans-serif;

  font-size: 12px;
  font-weight: 600;
  line-height: 1;

  padding: 6px 12px;
  border-radius: 11px;

  z-index: 999999;

  /* ‚ùå nessuna scala, mai */
  transform: none !important;
  zoom: 1 !important;
}

/* üîí testo interno */
#wait-bar span {
  all: unset;
  font: inherit;
  color: inherit;
  line-height: inherit;
}

/* testo descrittivo */
#wait-full {
  font-size: 11.5px;
  font-weight: 500;
  opacity: 0.75;
}

/* countdown */
#wait-time,
#wait-mmss {
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 0.2px;
}
/* ‚ò∞ MENU BUTTON ‚Äì PROFILO (identico a HOME) */
#menu-btn{
  position: absolute;
  left: 14px;
  top: 14px;              /* üîí BLOCCATO */
  height: 27px;           /* met√† top bar */
  display: flex;
  align-items: center;

  background: transparent;
  border: none;
  box-shadow: none;
  padding: 0;
  margin: 0;

  font-size: 22px;
  line-height: 1;
  color: #111;

  cursor: pointer;
  z-index: 10001;
}

#menu-btn:active{
  opacity: .6;
}
#menu-btn{
  position: absolute;
  left: 14px;
  top: 50%;
  transform: translateY(-50%);
}
/* ===== FOOTER PROFILO / GLOBALE ===== */
.profile-footer{
  padding: 10px 12px 14px;
  text-align: center;
  font-size: 12px;
  color: #8e8e93;
}

.profile-footer a{
  color:#8e8e93;
  text-decoration:none;
  font-weight:500;
}

.profile-footer a:hover{
  text-decoration:underline;
}

.footer-links{
  margin-bottom:8px;
}

.footer-copy{
  margin-bottom:4px;
}

.footer-version{
  opacity:.6;
}

/* ===============================
   üçé HERO APPLE STYLE
=============================== */

.hero{
  position: relative;
  height: calc(var(--real-vh) * 0.6);
  overflow: hidden;
  background: #000;
}

.hero-img{
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;

  transform: scale(1.08);
  transition: transform 1.2s ease;
}

.hero-content{
  position: relative;
  z-index: 2;
  height: 100%;

  display: flex;
  flex-direction: column;
  align-items: center;

  /* ‚úÖ invece di center */
  justify-content: flex-start;

  padding-top: 28vh;   /* ‚¨ÖÔ∏è QUI controlli l‚Äôaltezza */
  padding-left: 20px;
  padding-right: 20px;

  text-align: center;
  color: #fff;
}

.hero-content h1{
  font-size: 42px;
  font-weight: 700;
  margin-bottom: 12px;
}

.hero-content p{
  font-size: 18px;
  opacity: 0.85;
  margin-bottom: 28px;
}

.hero-btn{
  padding: 14px 22px;
  font-size: 16px;
  font-weight: 600;
  border-radius: 14px;

  background: #ff7a00;
  color: #fff;
  text-decoration: none;

  box-shadow: 0 8px 24px rgba(0,0,0,0.35);
}

/* overlay scuro stile Apple */
.hero::after{
  content:"";
  position:absolute;
  inset:0;
  background: linear-gradient(
    to bottom,
    rgba(0,0,0,0.45),
    rgba(0,0,0,0.55)
  );
}
/* ===============================
   üçè REVEAL ON SCROLL (APPLE)
=============================== */

.reveal{
  opacity: 0;
  transform: translateY(40px);
  transition: all 0.9s cubic-bezier(.22,.61,.36,1);
}

.reveal.in-view{
  opacity: 1;
  transform: translateY(0);
}


/* ===============================
   üçé EXPERIENCE SECTION
=============================== */

.experience{
  position: relative;
  height: var(--real-vh);
  background: #f6f6f7;
}

.experience-inner{
  position: relative;
  height: 100%;

  display: flex;
  flex-direction: column;
  justify-content: center;

  padding-bottom: 160px; /* spazio fisso per CTA + pill */
  box-sizing: border-box;

  overflow: hidden;
}

.exp-step{
  position: absolute;
  inset: 0;

  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;   /* ‚¨ÖÔ∏è NON center */

  text-align: center;
  padding-top: 80px;            /* ‚¨ÖÔ∏è distanza dall‚Äôalto */
  padding-left: 20px;
  padding-right: 20px;

  opacity: 0;
  transform: translateX(60px);
}

.exp-step.active{
  opacity: 1;
  transform: translateX(0);
}

.exp-step h2{
  font-size: 34px;
  font-weight: 700;
  margin-bottom: 12px;
}

.exp-step p{
  font-size: 18px;
  color: #444;
  max-width: 420px;
}

/* ===============================
   üçè EXPERIENCE INDICATOR (APPLE)
=============================== */

.exp-indicator{
  position: absolute;
  bottom: 60px;          /* distanza dal fondo */
  left: 50%;
  transform: translateX(-50%);
  z-index: 5;
}

.exp-bar{
  display: flex;
  align-items: center;
  gap: 8px;

  padding: 8px 14px;
  border-radius: 999px;

  background: rgba(0,0,0,0.06);
  backdrop-filter: blur(8px);
}

/* pallini */
.exp-bar span{
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: #bbb;
  opacity: .5;
  position: relative;
  overflow: hidden;
}

.exp-bar span::after{
  content:"";
  position:absolute;
  inset:0;
  background:#111;
  transform: scaleX(0);
  transform-origin: left;
}

.exp-bar span.active{
  width: 26px;
  border-radius: 999px;
  opacity: 1;
}

.exp-bar span.active::after{
  animation: progress 5s linear forwards;
}

@keyframes progress{
  from{ transform: scaleX(0); }
  to{ transform: scaleX(1); }
}

.exp-cta{
  padding: 8px 16px;          /* piccolo */
  font-size: 13px;
  font-weight: 600;

  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;

  background: #007aff;
  color: #fff;

  border-radius: 999px;
  box-shadow: 0 4px 12px rgba(0,122,255,.35);

  text-decoration: none !important;
  white-space: nowrap;

  transition: transform .2s ease, box-shadow .2s ease;
}

.exp-cta:hover{
  transform: scale(1.04);
  box-shadow: 0 10px 26px rgba(0,122,255,.45);
}

.exp-cta:active{
  transform: scale(0.96);
}

/* üîí mai stile link */
.exp-cta,
.exp-cta:link,
.exp-cta:visited,
.exp-cta:hover,
.exp-cta:active,
.exp-cta:focus{
  color:#fff !important;
  text-decoration:none !important;
}

/* üîí STRUTTURA BLOCCATA EXPERIENCE */
.experience-inner{
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
}

/* SLIDE PRENDONO SPAZIO */
.exp-slides{
  order: 1;
  flex: 1;
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* üî• PULSANTE SEMPRE DOPO IMMAGINE */
.exp-cta{
  order: 2;
  position: static !important;

  margin: 10px 0 12px 0;   /* leggermente pi√π compatto */
  padding: 6px 14px;       /* ‚¨ÖÔ∏è PI√ô PICCOLO */
  font-size: 12.5px;       /* ‚¨ÖÔ∏è leggermente ridotto */
  font-weight: 600;

  background: #007aff;
  color: #fff;

  border-radius: 999px;
  text-decoration: none !important;
  box-shadow: 0 3px 10px rgba(0,122,255,.32);

  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;

  white-space: nowrap;
}

/* PILL SEMPRE SOTTO */
.exp-indicator{
  order: 3;
  margin-bottom: 40px;
}
/* ===== SPAZIATURE STEP (SOLO DISTANZE) ===== */

/* ‚úÖ avvicina sottotitolo al titolo */
.exp-step h2{
  margin-bottom: 12px;   /* distanza titolo ‚Üí sottotitolo */
}

.exp-step p{
  margin-bottom: 80px;   /* distanza sottotitolo ‚Üí immagine */
}


/* ===============================
   üçé IMAGE CARD ‚Äì BACKGROUND
=============================== */

.exp-image{
  /* ‚ùå NIENTE absolute */
  position: relative;

  width: 100%;
  max-width: 420px;

  height: 435px;        /* altezza card */
  margin-top: -120px;    /* ‚¨ÖÔ∏è cresce SOLO verso l‚Äôalto */
  margin-bottom: 12px;  /* distanza dal bottone */

  border-radius: 24px;
  overflow: hidden;

  box-shadow:
    0 12px 32px rgba(0,0,0,0.12),
    0 2px 6px rgba(0,0,0,0.08);

  z-index: 1;           /* dietro testi e bottone */
}

.exp-image img{
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}
.exp-step h2{
  margin-bottom: 6px;   /* titolo ‚Üî sottotitolo */
}

.exp-step p{
  margin-bottom: 12px;  /* sottotitolo ‚Üî immagine */
}
/* Testi sopra la card */
.exp-step h2,
.exp-step p{
  position: relative;
  z-index: 3;
}

/* Bottone sopra la card */
.exp-cta{
  position: relative;
  z-index: 3;
  margin-top: 220px;   /* ‚¨ÖÔ∏è lo ‚Äúappoggi‚Äù sopra l‚Äôimmagine */
}
/* üì± MOBILE FIX ‚Äì pill pi√π vicino al bottone */
@media (max-width: 768px){

  .exp-indicator{
    position: static;          /* ‚¨ÖÔ∏è rientra nel flusso */
    margin-top: 14px;          /* distanza dal bottone */
    margin-bottom: 20px;       /* respiro sotto */
    transform: none;
  }

  .experience-inner{
    padding-bottom: 300px;      /* meno spazio inutile */
  }
}
.hero-after-coppa{
  height: 60vh;
  background: #000;
}

.hero-after-coppa .hero-content{
  padding-top: 28vh;
}

.hero-after-coppa .hero-subtitle{
  font-size: 18px;
  color: #fff;
  opacity: .9;
  max-width: 420px;
}
.hero-after-coppa{
  margin-top: -240px;   /* prova -60 / -80 / -100 */
}

/* ===============================
   üçé HERO ‚Äì LAVORA CON NOI
=============================== */

.hero-lavora{
  height: 60vh;
}

.hero-lavora .hero-content{
  padding-top: 36vh;   /* leggermente pi√π su */
}

.hero-lavora .hero-sub{
  font-size: 18px;
  opacity: .9;
  margin-bottom: 20px;
}

/* bottone variante */
.hero-btn-outline{
  background: transparent;
  border: 2px solid #fff;
  color: #fff;
  box-shadow: none;
}

.hero-btn-outline:hover{
  background: #fff;
  color: #000;
}
.hero-lavora{
  margin-top: 120px;   /* regola qui la distanza tra le due hero */
}
.hero-info{
  margin-top: 120px;   /* stacco netto dalla hero Lavora con noi */
}

/* ‚¨ÜÔ∏è SCROLL TO TOP BUTTON */
#scroll-top-btn{
  position: fixed;
  right: 16px;
  bottom: 110px;

  width: 42px;
  height: 42px;

  border-radius: 50%;
  background: #007aff; /* üîµ BLU iOS */
  color: #fff;

  display: flex;
  align-items: center;
  justify-content: center;

  font-size: 18px;
  font-weight: 700;

  box-shadow: 0 8px 24px rgba(0,122,255,.45); /* ombra blu */

  opacity: 0;
  pointer-events: none;
  transform: translateY(10px);

  transition: 
    opacity .25s ease,
    transform .25s ease;

  z-index: 9999;
}
#scroll-top-btn:active{
  transform: scale(.92);
  background: #0066d6;
}

#scroll-top-btn.show{
  opacity: 1;
  pointer-events: auto;
  transform: translateY(0);
}

#scroll-top-btn:active{
  transform: scale(.92);
}

/* ‚ûï PLUS MENU HERO */
#menu-plus-btn,
#info-plus-btn{
  position: absolute;
  right: 16px;
  bottom: 16px;

  width: 48px;
  height: 48px;

  border-radius: 50%;
  background: #007aff;
  color: #fff;

  display: flex;
  align-items: center;
  justify-content: center;

  font-size: 28px;
  font-weight: 500;
  line-height: 1;

  border: none;
  cursor: pointer;

  box-shadow: 0 10px 28px rgba(0,122,255,.45);
  z-index: 5;
}

#menu-plus-btn:active,
#info-plus-btn:active{
  transform: scale(.92);
  background: #0066d6;
}

/* ===============================
   ‚ÑπÔ∏è INFO SLIDES ‚Äì COLLASSATE
=============================== */

#info-slides{
  max-height: 0;
  overflow: hidden;
  opacity: 0;
  transform: translateY(-40px);
  pointer-events: none;

  transition:
    max-height .6s cubic-bezier(.22,.61,.36,1),
    opacity .35s ease,
    transform .6s cubic-bezier(.22,.61,.36,1);
}

/* üîì APERTE */
#info-slides.open{
  max-height: 1200px;
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

/* stato chiuso ‚Üí niente slide visibili */
#info-slides:not(.open) .exp-slides{
  display: none;
}

/* ===============================
   üç® MENU SLIDES ‚Äì COLLASSATE
=============================== */

#menu-slides{
  max-height: 0;
  overflow: hidden;
  opacity: 0;
  transform: translateY(-40px);
  pointer-events: none;

  transition:
    max-height .6s cubic-bezier(.22,.61,.36,1),
    opacity .35s ease,
    transform .6s cubic-bezier(.22,.61,.36,1);
}

/* üîì APERTE */
#menu-slides.open{
  max-height: 1200px;   /* abbastanza per tutte le slide */
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

/* CREA COPPA ‚Üí resta fullscreen */
.experience:not([data-type="menu"]){
  height: 100vh;
}


/* MENU SLIDES: stato chiuso */
#menu-slides:not(.open) .exp-slides{
  display: none;
}

/* üñ•Ô∏è DESKTOP: MENU -> CTA + PILL pi√π in basso (come ‚ÄúScegli i gusti‚Äù) */
@media (min-width: 900px){
  .experience[data-type="menu"] .exp-cta{
    margin-top: 220px !important;   /* ‚¨ÖÔ∏è abbassa SOLO il bottone */
  }

  .experience[data-type="menu"] .exp-indicator{
    margin-top: 14px !important;    /* sotto al bottone */
    margin-bottom: 40px !important; /* respiro come l‚Äôaltra sezione */
  }
}

/* ===============================
   ‚úÖ MENU SLIDES ‚Äì SPAZIO SOLO QUANDO APERTE
=============================== */

/* stato chiuso ‚Üí IDENTICO a prima */
.experience-menu{
  margin-bottom: 0;
}

#site-alert{
  position: fixed;
  top: 55px;
  left: 0;
  width: 100%;
  height: 42px;

  background: #fffae6;
  color: #333;

  display: none;                 /* mostrato solo via JS */
  align-items: center;
  justify-content: center;

  padding: 0 44px;               /* spazio per la X */
  box-sizing: border-box;

  font-size: 14px;
  font-weight: 600;

  z-index: 998;
  border-bottom: 1px solid #e6d98c;
}

/* TESTO CENTRATO */
#site-alert-text{
  text-align: center;
  line-height: 1.3;
  white-space: nowrap;
}

/* PULSANTE X */
#site-alert button{
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);

  width: 26px;
  height: 26px;

  border: none;
  background: #e5e5ea;
  border-radius: 50%;

  font-size: 16px;
  font-weight: 700;
  color: #333;

  display: flex;
  align-items: center;
  justify-content: center;

  cursor: pointer;
}

.popup-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

.popup-box{
  background:#fff;
  border-radius:16px;
  padding:22px;
  max-width:360px;
  width:90%;
  text-align:center;
  box-shadow:0 12px 30px rgba(0,0,0,.25);
}

.popup-box h2{
  margin-top:0;
  font-size:20px;
}

.popup-box p{
  font-size:14px;
  line-height:1.5;
  margin:14px 0 20px;
}

.popup-actions{
  display:flex;
  gap:10px;
}

.popup-btn{
  flex:1;
  padding:10px;
  border-radius:10px;
  border:none;
  font-weight:600;
  font-size:14px;
  cursor:pointer;
}

.popup-btn.primary{
  background:#007aff;
  color:#fff;
}

.popup-btn.secondary{
  background:#eee;
  color:#111;
}
/* üîí blocca scroll quando popup aperto */
body.popup-open{
  overflow: hidden;
}

/* üå´Ô∏è blur dello sfondo */
body.popup-open > *:not(#popup-benvenuto){
  filter: blur(6px);
  pointer-events: none;
}

/* popup sempre nitido */
#popup-benvenuto{
  filter: none !important;
  pointer-events: auto;
}
.welcome-hide-row{
  margin-top: 18px;      /* distanza dal testo sopra */
  margin-bottom: 22px;   /* üî• stacco dai pulsanti */
  text-align: center;
}

.welcome-hide-row label{
  display: inline-flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  color: #666;
}

.welcome-hide-row input{
  width: 16px;
  height: 16px;
  accent-color: #007aff; /* iOS blue */
  cursor: pointer;
}


/* üñ•Ô∏è DESKTOP: evita che l'hero successivo si sovrapponga alle slide */
@media (min-width: 900px){
  .hero-after-coppa{
    margin-top: 80px !important;   /* oppure 0 se lo vuoi attaccato */
  }
}

/* üñ•Ô∏è DESKTOP ‚Äì MENU: riduce SOLO spazio sopra la card */
@media (min-width: 900px){
  .experience[data-type="menu"] .exp-step{
    padding-top: 20px;   /* prima era 80px */
  }
}




  </style>

  <link rel="stylesheet" href="bottom-nav.css">
</head>

<body>


<!-- üîù BARRA FISSA -->
<div id="top-fixed-bar">

  <button id="menu-btn" aria-label="Menu">‚ò∞</button>

  <a href="home.html" class="home-btn">
    <img src="tastohome.png" alt="home">
  </a>

</div>

<div id="lang-toggle">üáÆüáπ ‚ñæ</div>

<div id="lang-menu">
  <button class="lang-btn" data-lang="it">Italiano</button>
  <button class="lang-btn" data-lang="en">English</button>
  <button class="lang-btn" data-lang="de">Deutsch</button>
</div>


<div id="top-fixed-spacer"></div>

<!-- üîî AVVISO SITO -->
<div id="site-alert">
  <span id="site-alert-text"></span>
  <button onclick="chiudiAvviso()">‚úï</button>
</div>



<button id="scroll-top-btn" aria-label="Torna su">
  ‚Üë
</button>



<section class="hero">
  <img src="img/hero-gelato.jpg" class="hero-img" alt="Gelato artigianale">

  <div class="hero-content reveal">
    <p>
      Crea la tua coppa. Vivi l‚Äôesperienza.
    </p>

  </div>
</section> 

<section class="experience">
  <div class="experience-inner">

    <!-- SLIDE AREA -->
    <div class="exp-slides">

      <div class="exp-step active">
        <h2>Scegli il formato</h2>
        <p>Piccola, media o grande.</p>
        <div class="exp-image">
          <img src="img/exp-formato.jpg">
        </div>
      </div>

      <div class="exp-step">
        <h2>Scegli i gusti</h2>
        <p>I tuoi gusti preferiti.</p>
        <div class="exp-image">
          <img src="img/exp-formato.jpg">
        </div>
      </div>

      <div class="exp-step">
        <h2>Personalizzala</h2>
        <p>Rendi unica la tua coppa.</p>
        <div class="exp-image">
          <img src="img/exp-formato.jpg">
        </div>
      </div>

      <div class="exp-step">
        <h2>Goditela</h2>
        <p>Comunica la coppa al cameriere.</p>
        <div class="exp-image">
          <img src="img/exp-formato.jpg">
        </div>
      </div>

    </div>

    <!-- CTA FISSO -->
    <a href="crea-coppa.html" class="exp-cta">
      Crea la tua coppa
    </a>

    <!-- PILL -->
    <div class="exp-indicator">
      <div class="exp-bar">
        <span class="active"></span>
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>

  </div>
</section>

<section class="hero hero-after-coppa">
  <img src="img/hero-menu.jpg" class="hero-img" alt="Menu Casa del Gelato">

  <div class="hero-content reveal">
    <p class="hero-subtitle">
      Scopri tutti i nostri gusti e ingredienti.
    </p>
  </div>
  <button id="menu-plus-btn" aria-label="Apri menu">
  +
</button>
</section>

<section id="menu-slides"
         class="experience experience-menu"
         data-type="menu">

  <div class="experience-inner">

    <!-- SLIDES -->
    <div class="exp-slides">

      <div class="exp-step active">
        <h2>Coppe</h2>
        <p>Scopri tutte le nostre coppe.</p>
        <div class="exp-image">
          <img src="img/menu-coppe.jpg">
        </div>
      </div>

      <div class="exp-step">
        <h2>Coni</h2>
        <p>Croccanti e artigianali.</p>
        <div class="exp-image">
          <img src="img/menu-coni.jpg">
        </div>
      </div>

      <div class="exp-step">
        <h2>Vaschette</h2>
        <p>Porta il gelato a casa.</p>
        <div class="exp-image">
          <img src="img/menu-vaschette.jpg">
        </div>
      </div>

      <div class="exp-step">
        <h2>Torte gelato</h2>
        <p>Per ogni occasione.</p>
        <div class="exp-image">
          <img src="img/menu-torte.jpg">
        </div>
      </div>

    </div>

    <!-- CTA -->
    <a href="menu.html" class="exp-cta">
      Vai al menu
    </a>

    <!-- PILL -->
    <div class="exp-indicator">
      <div class="exp-bar">
        <span class="active"></span>
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>

  </div>
</section>

<section class="hero hero-after-menu hero-lavora">
  <img src="img/hero-lavora.jpg" class="hero-img" alt="Lavora con noi">

  <div class="hero-content reveal">
    <p class="hero-sub">
      Entra a far parte del team Casa del Gelato
    </p>

    <a href="lavora-con-noi.html" class="hero-btn hero-btn-outline">
      Lavora con noi
    </a>
  </div>
</section>

<section class="hero hero-info">
  <img src="img/hero-info.jpg" class="hero-img" alt="Info e contatti">

  <div class="hero-content">
    <p>Info e contatti</p>
    <p>Orari, indirizzi e tutto quello che ti serve.</p>

    <a href="info-contatti.html" class="hero-btn hero-btn-outline">
      Info & Contatti
    </a>
  </div>
  <button id="info-plus-btn" aria-label="Apri info">
  +
</button>
</section>

<section id="info-slides"
         class="experience experience-info"
         data-type="info">

  <div class="experience-inner">

    <div class="exp-slides">

      <div class="exp-step active">
        <h2>Orari</h2>
        <p>I nostri orari di apertura.</p>
        <div class="exp-image">
          <img src="img/info-orari.jpg">
        </div>
      </div>

      <div class="exp-step">
        <h2>Dove siamo</h2>
        <p>Vieni a trovarci.</p>
        <div class="exp-image">
          <img src="img/info-mappa.jpg">
        </div>
      </div>

      <div class="exp-step">
        <h2>Contatti</h2>
        <p>Scrivici o chiamaci.</p>
        <div class="exp-image">
          <img src="img/info-contatti.jpg">
        </div>
      </div>

    </div>

    <a href="info-contatti.html" class="exp-cta">
      Vai a Info & Contatti
    </a>

    <div class="exp-indicator">
      <div class="exp-bar">
        <span class="active"></span>
        <span></span>
        <span></span>
      </div>
    </div>

  </div>
</section>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAEO7AonQeZ9SsgXd1Ymw2NZW-Pg4mI8E8",
    authDomain: "casadelgelato-db282.firebaseapp.com",
    projectId: "casadelgelato-db282",
    storageBucket: "casadelgelato-db282.firebasestorage.app",
    messagingSenderId: "121009770190",
    appId: "1:121009770190:web:81b82b82cc9bdb686cca9f"
  };

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();
</script>




<script>
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("SW registrato"))
        .catch(err => console.error("SW errore:", err));
}
</script>

<script>
// Nasconde il tasto "Coppe create" se NON sei registrato
document.addEventListener("DOMContentLoaded", () => {
    const logged = localStorage.getItem("userLogged") === "1";
    const btnCrono = document.getElementById("btn-cronologia");

    if (!logged && btnCrono) {
        btnCrono.style.display = "none";
    }
});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
    const isLogged = localStorage.getItem("userLogged") === "1";
    const btn = document.getElementById("btn-disiscriviti");

    // Se NON sei registrato ‚Üí nascondi il tasto
    if (!isLogged) {
        if (btn) btn.style.display = "none";
    }
});
</script>
<script type="module">
import { supabase } from "./supabase.js";

let waitInterval = null;
let collapseTimeout = null;

function expandWaitBar() {
  const full = document.getElementById("wait-full");
  const compact = document.getElementById("wait-compact");

  if (!full || !compact) return;

  full.style.display = "inline";
  compact.style.display = "none";

  clearTimeout(collapseTimeout);
  collapseTimeout = setTimeout(collapseWaitBar, 5000);
}

function collapseWaitBar() {
  const full = document.getElementById("wait-full");
  const compact = document.getElementById("wait-compact");

  if (!full || !compact) return;

  full.style.display = "none";
  compact.style.display = "inline";
}

async function loadWaitTime() {
  const { data, error } = await supabase
    .from("wait_time")
    .select("*")
    .eq("id", 1)
    .single();

  if (error || !data) return;

  const bar = document.getElementById("wait-bar");
  const txt = document.getElementById("wait-time");

  if (!bar || !txt) return;

  // stop eventuale timer precedente
  if (waitInterval) {
    clearInterval(waitInterval);
    waitInterval = null;
  }

  if (!data.active || data.minutes <= 0) {
    bar.style.display = "none";
    return;
  }

  const startTime = new Date(data.updated_at).getTime();
  const totalSeconds = data.minutes * 60;

function tick() {
  const now = Date.now();
  const elapsed = Math.floor((now - startTime) / 1000);
  const remaining = totalSeconds - elapsed;

  if (remaining <= 0) {
    bar.style.display = "none";
    clearInterval(waitInterval);
    waitInterval = null;
    return;
  }

  const min = Math.floor(remaining / 60);
  const sec = remaining % 60;
  const timeStr = `${min}:${sec.toString().padStart(2, "0")}`;

  // üî¢ aggiorna entrambi i testi
  txt.textContent = timeStr;
  document.getElementById("wait-mmss").textContent = timeStr;

  bar.style.display = "flex";

// ‚è±Ô∏è quando inizia un nuovo minuto ‚Üí riapre la barra
if (sec === 59) {
  expandWaitBar();
}
}
  tick(); // ‚è±Ô∏è avvio immediato
  waitInterval = setInterval(tick, 1000);
}

// üî¥ REALTIME WAIT TIME
supabase
  .channel("wait-time-live")
  .on(
    "postgres_changes",
    {
      event: "*",
      schema: "public",
      table: "wait_time"
    },
    payload => {
      console.log("üîÅ wait_time aggiornato realtime:", payload);
      loadWaitTime();
    }
  )
  .subscribe();

document.addEventListener("DOMContentLoaded", loadWaitTime);
</script>



</div>



<div id="menu-overlay" style="
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.35);
  opacity:0;
  pointer-events:none;
  transition:.25s;
  z-index:10000;
"></div>

<div id="menu-dropdown" style="
  position:fixed;
  top:60px;
  left:14px;
  width:220px;
  background:#fff;
  border-radius:14px;
  box-shadow:0 12px 30px rgba(0,0,0,0.25);
  padding:10px;
  opacity:0;
  pointer-events:none;
  transform:translateY(-10px);
  transition:.25s;
  z-index:10002;
">
<a href="crea-coppa.html" class="menu-item menu-new-only">
  <span class="badge-new-left">NEW</span>
  <span>Crea Coppa</span>
</a>
<a href="home.html" class="menu-item">
  <svg class="menu-icon" viewBox="0 0 24 24" aria-hidden="true">
    <path d="M3 11.5L12 4l9 7.5" />
    <path d="M5 10.5V20a1 1 0 0 0 1 1h4v-6h4v6h4a1 1 0 0 0 1-1v-9.5" />
  </svg>
  <span>Home</span>
</a>
  <a href="menu.html" class="menu-item">
  <svg class="menu-icon" viewBox="0 0 24 24" aria-hidden="true">
    <rect x="6" y="4" width="12" height="16" rx="2"
          fill="none" stroke="currentColor" stroke-width="2"/>
    <line x1="9" y1="9" x2="15" y2="9"
          stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    <line x1="9" y1="13" x2="15" y2="13"
          stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    <line x1="9" y1="17" x2="13" y2="17"
          stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
  </svg>
  <span>Menu</span>
</a>
<a href="profilo.html" class="menu-item">
  <svg class="menu-icon" viewBox="0 0 24 24" aria-hidden="true">
    <path d="M12 12c2.761 0 5-2.239 5-5S14.761 2 12 2 7 4.239 7 7s2.239 5 5 5zm0 2c-4.418 0-8 2.239-8 5v1h16v-1c0-2.761-3.582-5-8-5z"/>
  </svg>
  <span>Profilo</span>
</a>
<a href="info-contatti.html" class="menu-item">
  <svg class="menu-icon" viewBox="0 0 24 24" aria-hidden="true">
    <!-- CERCHIO -->
    <circle
      cx="12"
      cy="12"
      r="9"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
    />

    <!-- PALLINO DELLA i -->
    <circle
      cx="12"
      cy="8"
      r="0.5"
      fill="currentColor"
    />

    <!-- STELO DELLA i -->
    <line
      x1="12"
      y1="11"
      x2="12"
      y2="17"
      stroke="currentColor"
      stroke-width="2.2"
      stroke-linecap="round"
    />
  </svg>
  <span>Info &amp; Contatti</span>
</a>
<a href="lavora-con-noi.html" class="menu-item">
  <svg class="menu-icon" viewBox="0 0 24 24" aria-hidden="true">
    <!-- corpo valigetta -->
    <rect x="3" y="7" width="18" height="13" rx="2"
          fill="none" stroke="currentColor" stroke-width="2"/>
    <!-- manico -->
    <path d="M9 7V5a3 3 0 0 1 6 0v2"
          fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round"/>
  </svg>
  <span>Lavora con noi</span>
</a>
</div>

<script>
  const menuBtn = document.getElementById("menu-btn");
  const menu = document.getElementById("menu-dropdown");
  const overlay = document.getElementById("menu-overlay");

  function openMenu(){
    menu.classList.add("open");
    menu.style.opacity = "1";
    menu.style.pointerEvents = "auto";
    menu.style.transform = "translateY(0)";

    overlay.style.opacity = "1";
    overlay.style.pointerEvents = "auto";
  }

  function closeMenu(){
    menu.classList.remove("open");
    menu.style.opacity = "0";
    menu.style.pointerEvents = "none";
    menu.style.transform = "translateY(-10px)";

    overlay.style.opacity = "0";
    overlay.style.pointerEvents = "none";
  }

  menuBtn.addEventListener("click", () => {
    const isOpen = menu.classList.contains("open");
    isOpen ? closeMenu() : openMenu();
  });

  overlay.addEventListener("click", closeMenu);

  // chiude con ESC
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closeMenu();
  });

  // chiude quando clicchi un link del menu
  menu.querySelectorAll("a").forEach(a => {
    a.addEventListener("click", closeMenu);
  });
</script>

<footer class="profile-footer">
  <div class="footer-links">
    <a href="privacy.html">Privacy</a> ¬∑
    <a href="termini.html">Termini</a> ¬∑
    <a href="cookie.html">Cookie</a>
  </div>

  <div class="footer-copy">
    ¬© 2026 Casa del Gelato
  </div>

  <div class="footer-version">
    Versione 1.0.0
  </div>
</footer>

<script>
const observer = new IntersectionObserver(entries => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      entry.target.classList.add("in-view");
    }
  });
}, { threshold: 0.4 });

document.querySelectorAll(".reveal").forEach(el => {
  observer.observe(el);
});
</script>




<script>
(() => {
  const btn = document.getElementById("scroll-top-btn");

  function checkScroll(){
    const scrollY = window.scrollY;
    const docH = document.documentElement.scrollHeight;
    const winH = window.innerHeight;

    // mostra SOLO quando sei quasi in fondo
    if (scrollY + winH > docH - 300){
      btn.classList.add("show");
    } else {
      btn.classList.remove("show");
    }
  }

  window.addEventListener("scroll", checkScroll, { passive: true });

  btn.addEventListener("click", () => {
    window.scrollTo({
      top: 0,
      behavior: "smooth"
    });
  });
})();
</script>



<script>
function initSwipeExperience(section) {
  if (!section) return;

  const slidesWrap = section.querySelector('.exp-slides');
  const steps = [...section.querySelectorAll('.exp-step')];
  const dots  = [...section.querySelectorAll('.exp-bar span')];

  let index = 0;
  let startX = 0;

  function show(i){
    steps.forEach((s, idx) =>
      s.classList.toggle("active", idx === i)
    );

    dots.forEach((d, idx) => {
      d.classList.toggle("active", idx === i);
      d.style.animation = "none";
      d.offsetHeight;
      if (idx === i) d.style.animation = "";
    });
  }

  function next(){
    index = (index + 1) % steps.length;
    show(index);
  }

  function prev(){
    index = (index - 1 + steps.length) % steps.length;
    show(index);
  }

  /* üì± TOUCH */
  slidesWrap.addEventListener("touchstart", e => {
    startX = e.touches[0].clientX;
  }, { passive: true });

  slidesWrap.addEventListener("touchend", e => {
    const diff = e.changedTouches[0].clientX - startX;
    if (Math.abs(diff) > 50){
      diff < 0 ? next() : prev();
    }
  });

  /* üñ±Ô∏è MOUSE */
  slidesWrap.addEventListener("mousedown", e => {
    startX = e.clientX;
  });

  window.addEventListener("mouseup", e => {
    const diff = e.clientX - startX;
    if (Math.abs(diff) > 50){
      diff < 0 ? next() : prev();
    }
  });
}
</script>

<script>
function initAutoplayOnExpand({
  sectionSelector,
  triggerBtnId
}) {
  const section = document.querySelector(sectionSelector);
  const btn = document.getElementById(triggerBtnId);
  if (!section || !btn) return;

  const slidesWrap = section.querySelector('.exp-slides');
  const steps = [...section.querySelectorAll('.exp-step')];
  const dots  = [...section.querySelectorAll('.exp-bar span')];

  let index = 0;
  let timer = null;
  const DELAY = 5000;

  function show(i){
    steps.forEach((s, idx) =>
      s.classList.toggle("active", idx === i)
    );

    dots.forEach((d, idx) => {
      d.classList.toggle("active", idx === i);
      d.style.animation = "none";
      d.offsetHeight;
      if (idx === i) d.style.animation = "";
    });
  }

  function next(){
    index = (index + 1) % steps.length;
    show(index);
  }

  function start(){
    stop();
    timer = setInterval(next, DELAY);
  }

  function stop(){
    clearInterval(timer);
    timer = null;
  }

  btn.addEventListener("click", () => {
    const slides = section;
const isOpening = slides.dataset.open === "1";
    if (!isOpening) {
      stop();
      return;
    }

    setTimeout(() => {
      index = 0;
      show(0);
      start();
    }, 300);
  });
}

document.addEventListener("DOMContentLoaded", () => {
  initAutoplayOnExpand({
    sectionSelector: '.experience[data-type="menu"]',
    triggerBtnId: 'menu-plus-btn'
  });

  initAutoplayOnExpand({
    sectionSelector: '.experience[data-type="info"]',
    triggerBtnId: 'info-plus-btn'
  });
});
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  initSwipeExperience(
    document.querySelector('.experience:not([data-type="menu"])')
  );
});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  initSwipeExperience(
    document.querySelector('.experience[data-type="menu"]')
  );
});
</script>

<script>
(() => {
  const section = document.querySelector('.experience[data-type="menu"]');
  if (!section) return;

  const slidesWrap = section.querySelector('.exp-slides');
  const steps = [...section.querySelectorAll('.exp-step')];
  const dots  = [...section.querySelectorAll('.exp-bar span')];

  let index = 0;
  let startX = 0;
  let timer = null;
  const DELAY = 5000;

  function show(i){
    steps.forEach((s, idx) =>
      s.classList.toggle("active", idx === i)
    );

    dots.forEach((d, idx) => {
      d.classList.toggle("active", idx === i);
      d.style.animation = "none";
      d.offsetHeight;
      if (idx === i) d.style.animation = "";
    });
  }

  function next(){
    index = (index + 1) % steps.length;
    show(index);
  }

  function prev(){
    index = (index - 1 + steps.length) % steps.length;
    show(index);
  }

  function start(){
    stop();
    timer = setInterval(next, DELAY);
  }

  function stop(){
    clearInterval(timer);
    timer = null;
  }

  /* üîÅ RESET quando il menu viene aperto */
  const menuBtn = document.getElementById("menu-plus-btn");
  menuBtn.addEventListener("click", () => {
    setTimeout(() => {
      index = 0;
      show(0);
      start();
    }, 300); // attende apertura animazione
  });

  /* üì± TOUCH */
  slidesWrap.addEventListener("touchstart", e => {
    startX = e.touches[0].clientX;
  }, { passive: true });

  slidesWrap.addEventListener("touchend", e => {
    const diff = e.changedTouches[0].clientX - startX;
    if (Math.abs(diff) > 50){
      diff < 0 ? next() : prev();
      start(); // üîÅ riparte autoplay
    }
  });

  /* üñ±Ô∏è MOUSE */
  slidesWrap.addEventListener("mousedown", e => {
    startX = e.clientX;
  });

  window.addEventListener("mouseup", e => {
    const diff = e.clientX - startX;
    if (Math.abs(diff) > 50){
      diff < 0 ? next() : prev();
      start();
    }
  });

})();
</script>

<script>
(() => {
  const section = document.getElementById("info-slides");
  const btnOpen = document.getElementById("info-plus-btn");
  if (!section || !btnOpen) return;

  const slidesWrap = section.querySelector(".exp-slides");
  const steps = [...section.querySelectorAll(".exp-step")];
  const dots  = [...section.querySelectorAll(".exp-bar span")];
  if (!slidesWrap || !steps.length || !dots.length) return;

  let index = 0;
  let startX = 0;
  let timer = null;
  const DELAY = 5000;

  function show(i){
    steps.forEach((s, idx) => s.classList.toggle("active", idx === i));

    dots.forEach((d, idx) => {
      d.classList.toggle("active", idx === i);
      d.style.animation = "none";
      d.offsetHeight; // reset
      if (idx === i) d.style.animation = "";
    });
  }

  function next(){
    index = (index + 1) % steps.length;
    show(index);
  }

  function start(){
    stop();
    timer = setInterval(next, DELAY);
  }

  function stop(){
    if (timer) clearInterval(timer);
    timer = null;
  }

  // swipe (come le altre)
  slidesWrap.addEventListener("touchstart", e => {
    startX = e.touches[0].clientX;
  }, { passive: true });

  slidesWrap.addEventListener("touchend", e => {
    const diff = e.changedTouches[0].clientX - startX;
    if (Math.abs(diff) > 50){
      index = diff < 0 ? (index + 1) % steps.length : (index - 1 + steps.length) % steps.length;
      show(index);
      start(); // riparte autoplay
    }
  });

  slidesWrap.addEventListener("mousedown", e => { startX = e.clientX; });
  window.addEventListener("mouseup", e => {
    const diff = e.clientX - startX;
    if (Math.abs(diff) > 50){
      index = diff < 0 ? (index + 1) % steps.length : (index - 1 + steps.length) % steps.length;
      show(index);
      start();
    }
  });

  // ‚úÖ parte/si ferma quando apri/chiudi col +
  btnOpen.addEventListener("click", () => {
    setTimeout(() => {
      const isOpen = section.classList.contains("open");
      if (isOpen) {
        index = 0;
        show(0);
        start();
      } else {
        stop();
      }
    }, 350);
  });

})();
</script>

<script type="module">
import { supabase } from "./supabase.js";

const SESSION_KEY = "cdg_session_id";
const PING_EVERY = 15000; // 15s
let sessionId = localStorage.getItem(SESSION_KEY);

if (!sessionId) {
  sessionId = crypto.randomUUID();
  localStorage.setItem(SESSION_KEY, sessionId);
}

async function pingOnline() {
  const { error } = await supabase
    .from("online_users")
    .upsert({
      session_id: sessionId,
      last_seen: new Date().toISOString()
    }, {
      onConflict: "session_id"
    });

  if (error) {
    console.warn("online ping error", error.message);
  }
}

// ping subito
pingOnline();

// ping periodico
setInterval(pingOnline, PING_EVERY);

// ping quando la pagina torna visibile
document.addEventListener("visibilitychange", () => {
  if (!document.hidden) pingOnline();
});
</script>


<script type="module">
import { supabase } from "./supabase.js";

const alertBox  = document.getElementById("site-alert");
const alertText = document.getElementById("site-alert-text");

/* üî• FIX TIMEZONE */
function parseTs(ts){
  if (!ts) return null;
  // se manca la Z ‚Üí lo tratto come UTC (perch√© lo salvi con toISOString)
  return new Date(ts.endsWith("Z") ? ts : ts + "Z");
}

async function loadSiteAlert() {
  if (!alertBox || !alertText) return;

  alertBox.style.display = "none";

  const { data, error } = await supabase
    .from("site_alert")
    .select("*")
    .eq("id", 1)
    .single();

  if (error || !data) return;

  const nowMs = Date.now();
  const startMs = data.start_at ? Date.parse(data.start_at) : null;
  const endMs   = data.end_at   ? Date.parse(data.end_at)   : null;

  // üîí BLOCCO ASSOLUTO
  if (!data.enabled) return;
  if (startMs && nowMs < startMs) return;   // ‚¨ÖÔ∏è QUESTO ERA IL BUCO
  if (endMs && nowMs > endMs) return;

  alertText.textContent = data.text || "";
  alertBox.style.display = "flex";
}

// carica al load
window.addEventListener("load", () => {
  setTimeout(loadSiteAlert, 300);
});

// üî¥ REALTIME
supabase
  .channel("site-alert-live")
  .on(
    "postgres_changes",
    {
      event: "UPDATE",
      schema: "public",
      table: "site_alert"
    },
    () => {
      loadSiteAlert();
    }
  )
  .subscribe();
  // ‚è±Ô∏è ricontrolla ogni 30 secondi (solo orario)
setInterval(() => {
  loadSiteAlert();
}, 10000);
</script>



<script>
function chiudiAvviso(){
  const alert = document.getElementById("site-alert");
  if (alert) alert.style.display = "none";
}
</script>

<!-- üç® POPUP BENVENUTO -->
<div id="popup-benvenuto" class="popup-overlay" style="display:none">
  <div class="popup-box">

    <h2 style="
      font-size:22px;
      font-weight:800;
      margin-bottom:14px;
      letter-spacing:-0.3px;
    ">
      Benvenuto in <b>Casa del Gelato</b>
    </h2>

    <p style="
      font-size:15.5px;
      line-height:1.5;
      color:#333;
      margin-bottom:16px;
    ">
      Scopri il nostro <b>menu</b>, tutte le <b>info utili</b><br>
      e personalizza la tua <b>coppa</b> come desideri.
    </p>

    <p style="
      font-size:15px;
      font-weight:600;
      margin-bottom:6px;
    ">
      Registrandoti puoi:
    </p>

    <p style="
      font-size:15px;
      line-height:1.6;
      color:#333;
      margin-bottom:16px;
    ">
      ‚Ä¢ personalizzare le coppe<br>
      ‚Ä¢ salvare i tuoi preferiti<br>
      ‚Ä¢ accedere a <b>coupon e vantaggi esclusivi</b>
    </p>

<div class="welcome-hide-row">
  <label>
    <input type="checkbox" id="welcome-hide-forever">
    <span>Non mostrare pi√π</span>
  </label>
</div>

    <div class="popup-actions">
      <button class="popup-btn secondary" onclick="chiudiPopupBenvenuto()">
        Chiudi
      </button>

   <button class="popup-btn primary" onclick="vaiAllaRegistrazione()">
  Registrati
</button>
    </div>
  </div>
</div>

<script>
function chiudiPopupBenvenuto(){
  const popup = document.getElementById("popup-benvenuto");
  const checkbox = document.getElementById("welcome-hide-forever");

  if (!popup) return;

  // ‚úÖ salva preferenza
  if (checkbox && checkbox.checked) {
    localStorage.setItem("hideWelcomePopup", "1");
  }

  popup.style.display = "none";
  document.body.classList.remove("popup-open");
  document.body.style.overflow = "";
}

function vaiAllaRegistrazione(){
  chiudiPopupBenvenuto();
  window.location.href = "login.html?mode=register";
}
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const hide = localStorage.getItem("hideWelcomePopup") === "1";
  const isLogged = localStorage.getItem("userLogged") === "1";

  if (hide || isLogged) return;

  const popup = document.getElementById("popup-benvenuto");
  if (!popup) return;

  popup.style.display = "flex";
  document.body.classList.add("popup-open");
  document.body.style.overflow = "hidden";
});
</script>

<!-- GOOGLE TRANSLATE (invisibile) -->
<div id="google_translate_element" style="display:none;"></div>

<script>
/* ===============================
   üåç GOOGLE TRANSLATE INIT
=============================== */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
    pageLanguage: 'it',
    includedLanguages: 'it,en,de',
    autoDisplay: false
  }, 'google_translate_element');
}

/* ===============================
   üîó BRIDGE: forza lingua
=============================== */
function setGoogleLang(lang){
  const combo = document.querySelector(".goog-te-combo");
  if (!combo) {
    console.warn("Google Translate non pronto");
    return;
  }
  combo.value = lang;
  combo.dispatchEvent(new Event("change"));
}
</script>

<script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script>
/* ===============================
   üáÆüáπ üá¨üáß üá©üá™ LANGUAGE MENU
=============================== */
document.addEventListener("DOMContentLoaded", () => {
  const toggle  = document.getElementById("lang-toggle");
  const menu    = document.getElementById("lang-menu");
  const buttons = document.querySelectorAll(".lang-btn");

  if (!toggle || !menu || !buttons.length) return;

  const FLAGS = {
    it: "üáÆüáπ",
    en: "üá¨üáß",
    de: "üá©üá™"
  };

  // üîΩ toggle menu
  toggle.addEventListener("click", e => {
    e.stopPropagation();
    menu.classList.toggle("open");
  });

  // ‚ùå click fuori ‚Üí chiudi
  document.addEventListener("click", () => {
    menu.classList.remove("open");
  });

  menu.addEventListener("click", e => e.stopPropagation());

  // üåç click lingua
  buttons.forEach(btn => {
    btn.addEventListener("click", () => {
      const lang = btn.dataset.lang;

      localStorage.setItem("lang", lang);
      toggle.textContent = FLAGS[lang] + " ‚ñæ";
      menu.classList.remove("open");

      setGoogleLang(lang);
    });
  });

  // üîÅ ripristino lingua salvata
  const saved = localStorage.getItem("lang") || "it";
  toggle.textContent = FLAGS[saved] + " ‚ñæ";

  // ‚è≥ attende Google e applica
  setTimeout(() => setGoogleLang(saved), 800);
});
</script>


<script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script>
function initExpandableSlides({
  btnId,
  slidesId
}) {
  const btn = document.getElementById(btnId);
  const slides = document.getElementById(slidesId);

  if (!btn || !slides) return;

  let open = false;

  btn.addEventListener("click", () => {
    open = !open;

    slides.classList.toggle("open", open);
slides.dataset.open = open ? "1" : "0";
    btn.textContent = open ? "√ó" : "+";

    if (open) {

      /* üñ•Ô∏è DESKTOP: spazio verso HERO sopra */
      if (window.innerWidth > 768) {
        slides.style.marginTop = "140px";
        slides.style.marginBottom = "0";
      } 
      /* üì± MOBILE: comportamento originale */
      else {
        slides.style.marginTop = "";
        slides.style.marginBottom = "-360px";
      }

      /* üîÅ reset slide + pill */
      const steps = slides.querySelectorAll(".exp-step");
      const dots  = slides.querySelectorAll(".exp-bar span");

      steps.forEach(s => s.classList.remove("active"));
      dots.forEach(d => d.classList.remove("active"));

      if (steps[0]) steps[0].classList.add("active");
      if (dots[0])  dots[0].classList.add("active");

      slides.scrollIntoView({
        behavior: "smooth",
        block: "start"
      });

    } else {
      slides.style.marginTop = "";
      slides.style.marginBottom = "";
    }
  });
}
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  initExpandableSlides({
    btnId: "menu-plus-btn",
    slidesId: "menu-slides"
  });

  initExpandableSlides({
    btnId: "info-plus-btn",
    slidesId: "info-slides"
  });
});
</script>

<script>
(function () {
  function fixIOSViewport() {
    const height = window.visualViewport
      ? window.visualViewport.height
      : window.innerHeight;

    document.documentElement.style.setProperty(
      '--real-vh',
      `${height}px`
    );
  }

  fixIOSViewport();

  if (window.visualViewport) {
    window.visualViewport.addEventListener('resize', fixIOSViewport);
  }
  window.addEventListener('orientationchange', fixIOSViewport);
})();
</script>

</body>
</html>