<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>Casa del Gelato</title>
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="icon" href="favicon.png">
  <link rel="apple-touch-icon" href="icon-192.png">
 <script type="module" src="global.js"></script>


  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;margin:0;background:#f6f6f7;color:#111}
    header{text-align:center;padding:22px}

    /* Spazio sotto per non schiacciare la bottom bar */
body {
    padding-bottom: 90px;
}
/* Protezione icone bottom nav */
#bottom-nav img {
    width: 26px !important;
    height: 26px !important;
    object-fit: contain !important;
}
    /* üîù BARRA FISSA + HOME */
    #top-fixed-bar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 55px;
      display: flex;
      justify-content: center;
      align-items: center;
      background: white;
      border-bottom: 1px solid #ddd;
      z-index: 9999;
    }

    .home-btn {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 17px;
        color: #444;
        text-decoration: none;
    }

    .home-btn img {
        width: 28px;
        height: 28px;
    }

    /* spazio per far scendere il contenuto */
    #top-fixed-spacer {
      height: 55px;
      width: 100%;
    }
    /* Tasto Lavora con Noi (solo in index) */
.jobs-btn {
    position: absolute;
    left: 12px;
    top: 13px;
    padding: 6px 10px;
    background: #ff7a00;
    color: white;
    font-size: 14px;
    border-radius: 10px;
    text-decoration: none;
    font-weight: 600;
    z-index: 9999;
}

    /* LANGUAGE MENU */
    #lang-toggle{
      position:fixed; 
      top:14px; 
      right:14px;
      padding:6px 12px;
      border-radius:12px;
      background:white;
      border:1px solid #ddd;
      cursor:pointer; 
      font-size:18px;
      z-index:10000;
    }

#lang-menu{
  position: fixed;
  top: 54px;
  right: 14px;

  background: #fff;
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0,0,0,.25);

  min-width: 140px;

  opacity: 0;
  transform: translateY(-6px);
  pointer-events: none;

  transition: opacity .2s ease, transform .2s ease;

  z-index: 10002;
}

#lang-menu.open{
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}
    #lang-menu button{
      padding:10px 16px;
      border:none;
      background:transparent;
      cursor:pointer;
      font-size:15px;
      text-align:left;
      width:100%;
    }

    #lang-menu button:hover{background:#f2f2f2;}

    /* BUTTONS */
    .menu-section{padding:22px;text-align:center}
    .btn{
      display:block;width:240px;text-align:center;
      padding:12px 14px;border-radius:12px;background:#ff7a00;color:#fff;
      text-decoration:none;margin:14px auto;font-size:17px;font-weight:600;
    }

    /* CARDS */
    .shop-card {
      background:white;
      padding:16px;
      border-radius:14px;
      margin:14px auto;
      max-width:330px;
      box-shadow:0 2px 6px rgba(0,0,0,0.08);
      text-align:left;
    }
    .shop-card b {font-size:16px;margin-bottom:4px;display:block;}
    .shop-card a {text-decoration:none;margin-top:4px;display:block;font-size:15px;color:#007aff;}

/* ‚ò∞ MENU DROPDOWN */
#menu-dropdown a{
  display:block;
  padding:10px;
  border-radius:10px;
  text-decoration:none;
  color:#111;
  font-size:15px;
  font-weight:600; /* üî• COME INFO & CONTATTI */
}

#menu-dropdown a:hover{
  background:#f2f2f7;
}

.menu-item {
  display: flex !important;
  flex-direction: row !important;
  align-items: center !important;
  gap: 12px;
}

.menu-item svg.menu-icon {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
  stroke: #111;
  stroke-width: 1.8;
  fill: none;
  display: block; 

}
.icon-wrapper{
  position: relative;
  display: inline-flex;
  align-items: center;
}

.menu-new-only{
  display: flex;
  align-items: center;
  gap: 12px;
}

.badge-new-left{
  background:#ff3b30;
  color:#fff;
  font-size:9px;
  font-weight:700;
  padding:3px 6px;
  border-radius:999px;
}



/* ‚ò∞ MENU BUTTON ‚Äì PROFILO (identico a HOME) */
#menu-btn{
  position: absolute;
  left: 14px;
  top: 14px;              /* üîí BLOCCATO */
  height: 27px;           /* met√† top bar */
  display: flex;
  align-items: center;

  background: transparent;
  border: none;
  box-shadow: none;
  padding: 0;
  margin: 0;

  font-size: 22px;
  line-height: 1;
  color: #111;

  cursor: pointer;
  z-index: 10001;
}

#menu-btn:active{
  opacity: .6;
}
#menu-btn{
  position: absolute;
  left: 14px;
  top: 50%;
  transform: translateY(-50%);
}
/* ===== FOOTER PROFILO / GLOBALE ===== */
.profile-footer{
  padding: 10px 12px 14px;
  text-align: center;
  font-size: 12px;
  color: #8e8e93;
}

.profile-footer a{
  color:#8e8e93;
  text-decoration:none;
  font-weight:500;
}

.profile-footer a:hover{
  text-decoration:underline;
}

.footer-links{
  margin-bottom:8px;
}

.footer-copy{
  margin-bottom:4px;
}

.footer-version{
  opacity:.6;
}

/* ===============================
   üçé HERO APPLE STYLE ‚Äì FIXED
=============================== */

.hero{
  position: relative;
  min-height: 60vh;

  margin: 40px 16px;
  border-radius: 28px;
  overflow: hidden;

  background: #fff;

  box-shadow:
    0 10px 30px rgba(0,0,0,0.08),
    0 2px 8px rgba(0,0,0,0.04);
}

/* sfondo */
.hero-img{
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}
#hero-info-video{
  object-fit: contain;
  object-position: center;
  background: #ffffff;
}

/* contenuto sopra immagine */
.hero-content{
  position: relative;
  z-index: 2;

  min-height: 60vh;          /* üî• stessa altezza della hero */
  display: flex;
  flex-direction: column;

  justify-content: flex-start; /* testi in alto */
  align-items: center;

  padding: 60px 24px 40px 24px; /* padding sotto per aria */

  text-align: center;
  color: #111;
}

/* titolo */
.hero-content h1{
  font-size: 42px;
  font-weight: 700;
  margin-bottom: 12px;
}

/* testo */
.hero-content p{
  font-size: 18px;
  opacity: 0.85;
  margin-bottom: 24px;
  font-weight: 900; /* üî• tutte bold */
}

/* ‚ùå ESCLUSIONE lavora con noi */
.hero-lavora .hero-sub{
  font-weight: 600; /* oppure 500 se lo vuoi pi√π leggero */
}

/* üî• QUESTO FA LA MAGIA */
.hero-btn{
  margin-top: auto;          /* spinge il bottone in fondo */
}

/* bottone stile Apple */
.hero-btn{
  padding: 14px 24px;
  font-size: 16px;
  font-weight: 600;
  border-radius: 14px;

  background: #007aff;
  color: #fff;
  text-decoration: none;

  display: inline-flex;
  align-items: center;
  justify-content: center;

  box-shadow: 0 8px 22px rgba(0,122,255,.35);

  transition: 
    background .2s ease,
    box-shadow .2s ease,
    transform .15s ease;
}

.hero-btn:hover{
  background:#0066d6;
  box-shadow: 0 12px 30px rgba(0,122,255,.45);
}

.hero-btn:active{
  transform: scale(.96);
}
/* ===============================
   üçè REVEAL ON SCROLL (APPLE)
=============================== */

.reveal{
  opacity: 0;
  transform: translateY(40px);
  transition: all 0.9s cubic-bezier(.22,.61,.36,1);
}

.reveal.in-view{
  opacity: 1;
  transform: translateY(0);
}






/* ===============================
   üçé HERO ‚Äì LAVORA CON NOI
=============================== */


.hero-lavora .hero-sub{
  font-size: 18px;
  font-weight: 900;                     /* üî• grassetto forte */
  color: #ffffff;                       /* üî• bianco */
  text-shadow: 0 3px 12px rgba(0,0,0,.55); /* contrasto sullo sfondo */

  margin-bottom: 20px;

  transform: translateY(-45px);          /* üîº alzata */
}


.hero-lavora{
  margin-top: 120px;   /* regola qui la distanza tra le due hero */
}
.hero-info{
  margin-top: 120px;   /* stacco netto dalla hero Lavora con noi */
}

/* ‚¨ÜÔ∏è SCROLL TO TOP BUTTON */
#scroll-top-btn{
  position: fixed;
  right: 16px;
  bottom: 110px;

  width: 42px;
  height: 42px;

  border-radius: 50%;
  background: #007aff; /* üîµ BLU iOS */
  color: #fff;

  display: flex;
  align-items: center;
  justify-content: center;

  font-size: 18px;
  font-weight: 700;

  box-shadow: 0 8px 24px rgba(0,122,255,.45); /* ombra blu */

  opacity: 0;
  pointer-events: none;
  transform: translateY(10px);

  transition: 
    opacity .25s ease,
    transform .25s ease;

  z-index: 9999;
}
#scroll-top-btn:active{
  transform: scale(.92);
  background: #0066d6;
}

#scroll-top-btn.show{
  opacity: 1;
  pointer-events: auto;
  transform: translateY(0);
}

#scroll-top-btn:active{
  transform: scale(.92);
}

/* ‚ûï PLUS MENU HERO */
#menu-plus-btn,
#info-plus-btn{
  position: absolute;
  right: 16px;
  bottom: 16px;

  width: 48px;
  height: 48px;

  border-radius: 50%;
  background: #007aff;
  color: #fff;

  display: flex;
  align-items: center;
  justify-content: center;

  font-size: 28px;
  font-weight: 500;
  line-height: 1;

  border: none;
  cursor: pointer;

  box-shadow: 0 10px 28px rgba(0,122,255,.45);
  z-index: 5;
}

#menu-plus-btn:active,
#info-plus-btn:active{
  transform: scale(.92);
  background: #0066d6;
}





#site-alert{
  position: fixed;
  top: 55px;
  left: 0;
  width: 100%;
  height: 42px;

  background: #fffae6;
  color: #333;

  display: none;                 /* mostrato solo via JS */
  align-items: center;
  justify-content: center;

  padding: 0 44px;               /* spazio per la X */
  box-sizing: border-box;

  font-size: 14px;
  font-weight: 600;

  z-index: 998;
  border-bottom: 1px solid #e6d98c;
}

/* TESTO CENTRATO */
#site-alert-text{
  text-align: center;
  line-height: 1.3;
  white-space: nowrap;
}

/* PULSANTE X */
#site-alert button{
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);

  width: 26px;
  height: 26px;

  border: none;
  background: #e5e5ea;
  border-radius: 50%;

  font-size: 16px;
  font-weight: 700;
  color: #333;

  display: flex;
  align-items: center;
  justify-content: center;

  cursor: pointer;
}

.popup-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

.popup-box{
  background:#fff;
  border-radius:16px;
  padding:22px;
  max-width:360px;
  width:90%;
  text-align:center;
  box-shadow:0 12px 30px rgba(0,0,0,.25);
}

.popup-box h2{
  margin-top:0;
  font-size:20px;
}

.popup-box p{
  font-size:14px;
  line-height:1.5;
  margin:14px 0 20px;
}

.popup-actions{
  display:flex;
  gap:10px;
}

.popup-btn{
  flex:1;
  padding:10px;
  border-radius:10px;
  border:none;
  font-weight:600;
  font-size:14px;
  cursor:pointer;
}

.popup-btn.primary{
  background:#007aff;
  color:#fff;
}

.popup-btn.secondary{
  background:#eee;
  color:#111;
}
/* üîí blocca scroll quando popup aperto */
body.popup-open{
  overflow: hidden;
}


/* popup sempre nitido */
#popup-benvenuto{
  filter: none !important;
  pointer-events: auto;
}
.welcome-hide-row{
  margin-top: 18px;      /* distanza dal testo sopra */
  margin-bottom: 22px;   /* üî• stacco dai pulsanti */
  text-align: center;
}

.welcome-hide-row label{
  display: inline-flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  color: #666;
}

.welcome-hide-row input{
  width: 16px;
  height: 16px;
  accent-color: #007aff; /* iOS blue */
  cursor: pointer;
}




/* wrapper mantiene centratura verticale */
.alert-wrapper {
  width: 100%;
  overflow: hidden;
}

/* testo che scorre */
.alert-track {
  display: inline-block;
  white-space: nowrap;
  padding-left: 100%;
  animation: scrollAlert 18s linear infinite;
}

/* animazione */
@keyframes scrollAlert {
  0%   { transform: translateX(0); }
  100% { transform: translateX(-100%); }
}

/* ===============================
   üìè SPAZIO UNIFORME TRA HERO
=============================== */

.hero + .hero{
  margin-top: 120px;   /* üîß regola qui lo spazio */
}

.hero-info{
  margin-bottom: 120px;   /* distanza dal footer */
}


/* =========================
   üë§ AVATAR FLOATING BUTTON
========================= */

#profile-avatar-btn{
  position: fixed;
  top: 2px;
  right: 14px;
  width: 48px;
  height: 48px;
  z-index: 10050;

  border-radius: 50%;
  border: 1px solid rgba(0,0,0,0.08);

  background: rgba(255,255,255,0.75);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);

  box-shadow: 0 10px 28px rgba(0,0,0,0.18);

  padding: 0;
  cursor: pointer;
}

#profile-avatar-btn > .profile-avatar{
  width: 100%;
  height: 100%;
  border-radius: 50%;

  display: flex;
  align-items: center;
  justify-content: center;
}

/* =========================
   üå´ BACKDROP
========================= */

#profile-menu-backdrop{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.18);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);

  z-index: 9998;

  opacity: 0;
  visibility: hidden;
  pointer-events: none;

  transition: opacity .25s ease;
}

#profile-menu-backdrop.show{
  opacity: 1;
  visibility: visible;
  pointer-events: auto;
}

/* =========================
   üßä LIQUID GLASS MENU
========================= */

#profile-menu{
  position: fixed;
  top: 62px;
  right: 12px;
  width: 230px;

  background: rgba(255,255,255,0.72);
  border: 1px solid rgba(255,255,255,0.55);
  border-radius: 16px;

  box-shadow: 0 18px 45px rgba(0,0,0,0.22);

  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);

  padding: 8px;
  z-index: 9999;

  opacity: 0;
  visibility: hidden;
  pointer-events: none;

  transform: translateY(-14px) scale(0.94);
  transform-origin: top right;

  transition:
    opacity .45s ease,
    transform .75s cubic-bezier(.16,1,.3,1);
}

#profile-menu.show{
  opacity: 1;
  visibility: visible;
  pointer-events: auto;

  transform: translateY(0) scale(1);
}

/* =========================
   üìã MENU ITEMS
========================= */

.glass-item{
  width: 100%;
  border: none;
  background: transparent;
  padding: 10px 10px;
  border-radius: 12px;

  font-size: 14px;
  font-weight: 700;
  color: #111;

  display:flex;
  align-items:center;
  gap: 8px;

  cursor: pointer;
  text-decoration: none;
  outline: none;
}

.glass-item:visited{
  color: #111;
  text-decoration: none;
}

.glass-item:hover{
  background: rgba(0,0,0,0.06);
}

.glass-item:active{
  background: rgba(0,0,0,0.10);
  transform: scale(0.99);
}

.glass-item.danger{
  color: #ff3b30;
}

/* ===============================
   üçé HERO PLUS ‚Äì Apple Rounded
=============================== */

.hero-plus-btn{
  position: absolute;
  right: 16px;
  bottom: 16px;

  width: 44px;
  height: 44px;

  border-radius: 50%;
  border: none;

  background: rgba(255,255,255,0.85);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);

  display: flex;
  align-items: center;
  justify-content: center;

  cursor: pointer;

  box-shadow:
    0 6px 20px rgba(0,0,0,.25),
    0 1px 2px rgba(0,0,0,.15);

  transition:
    transform .2s ease,
    background .2s ease,
    box-shadow .2s ease;
}

/* SVG */
.hero-plus-btn svg{
  width: 28px;          /* era 18px */
  height: 28px;         /* era 18px */
  stroke: #111;
  stroke-width: 3;      /* pi√π bold */
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

/* Hover */
.hero-plus-btn:hover{
  background: #fff;
}

/* Click */
.hero-plus-btn:active{
  transform: scale(.92);
  box-shadow:
    0 4px 12px rgba(0,0,0,.25);
}

/* ‚úÖ IMPORTANTISSIMO: l'immagine/video NON deve intercettare i click */
.hero-img{
  pointer-events: none;
}

/* ‚úÖ il + deve stare sopra a tutto nella hero */
.hero-plus-btn{
  z-index: 10;
}

/* (facoltativo) per sicurezza anche il contenuto */
.hero-content{
  z-index: 5;
}


/* ===============================
   üçé HERO POPUP ‚Äì SCROLL SAFE
=============================== */

/* ===== OVERLAY ===== */
.hero-popup-overlay{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.45);

  display: flex;
  align-items: center;
  justify-content: center;

  padding: 24px;
  box-sizing: border-box;

  opacity: 0;
  pointer-events: none;
  transition: opacity .25s ease;

  z-index: 100000;
}

.hero-popup-overlay.show{
  opacity: 1;
  pointer-events: auto;
}

/* ===== CARD ===== */
.hero-popup-card{
  width: 100%;
  max-width: 360px;

  max-height: 85vh;          /* üî• limite altezza */
  display: flex;
  flex-direction: column;

  background: #fff;
  border-radius: 24px;

  box-shadow: 0 25px 70px rgba(0,0,0,.35);
  position: relative;

  overflow: hidden;          /* evita sbordi */
}

/* ===== CLOSE BUTTON ===== */
.hero-popup-close{
  position: absolute;
  top: 14px;
  right: 14px;

  width: 30px;
  height: 30px;

  border-radius: 50%;
  border: none;

  background: #f2f2f7;
  font-size: 14px;
  cursor: pointer;

  z-index: 2;
}

/* ===== CONTENT WRAPPER (SCROLL) ===== */
.hero-popup-content{
  padding: 28px 22px 24px;

  overflow-y: auto;          /* üî• scroll interno */
  -webkit-overflow-scrolling: touch;

  display: flex;
  flex-direction: column;
  gap: 16px;
}

/* ===== TITLE ===== */
#hero-popup-title{
  font-size: 20px;
  font-weight: 700;
  letter-spacing: -0.3px;
}

/* ===== TEXT BLOCKS ===== */
.popup-lead{
  font-size: 16px;
  font-weight: 600;
  color: #111;
}

.popup-body,
.popup-steps{
  font-size: 14px;
  line-height: 1.6;
  color: #555;
}

.popup-highlight{
  font-size: 14px;
  font-weight: 600;
  color: #111;
}

/* ===== IMAGE ===== */
.hero-popup-content img{
  width: 140px;           /* dimensione cerchio */
  height: 140px;

  object-fit: cover;      /* riempie senza deformarsi */
  
  border-radius: 50%;     /* üî• CERCHIO PERFETTO */

  margin: 22px auto 0;    /* centrata */
  
  display: block;

  box-shadow: 
    0 10px 25px rgba(0,0,0,.15),
    0 0 0 6px #fff;       /* piccolo bordo bianco elegante */
}

/* BLOCCO INTRO */
.popup-hero{
  margin-bottom: 18px;
}

.popup-big{
  font-size: 22px;
  font-weight: 800;
  margin-top: 4px;
}

/* CARD GENERICHE */
.popup-card{
  background: #f7f7f9;
  padding: 14px 16px;
  border-radius: 14px;
  font-size: 14px;
  line-height: 1.6;
  margin-bottom: 14px;
}

.popup-card.subtle{
  background: #f2f2f5;
  color: #555;
}

/* STEPS CARD */
.popup-steps-card{
  background: linear-gradient(135deg,#f8fbff,#eef5ff);
  padding: 16px;
  border-radius: 16px;
  font-size: 14px;
  line-height: 1.8;
  margin-bottom: 18px;
  box-shadow: 0 4px 14px rgba(0,122,255,.08);
}

.popup-steps-card div{
  margin-bottom: 4px;
}

/* FINALE */
.popup-final{
  text-align: center;
  font-size: 15px;
  font-weight: 600;
  margin-top: 8px;
}

.popup-inline-cta{
  display: inline-block;
  margin-top: 6px;
  font-size: 15px;
  font-weight: 700;
  color: #007aff;
  text-decoration: none;
}

.popup-inline-cta:hover{
  text-decoration: underline;
}

.popup-inline-cta:active{
  opacity: .7;
}

.popup-inline-link{
  color:#007aff;
  font-weight:600;
  text-decoration:none;
}

.popup-inline-link:active{
  opacity:.7;
}
.avatar-btn{
  position: relative;
}

#profile-notif-badge{
  position: absolute;

  bottom: -3px;      /* sotto */
  left: -4px;        /* sinistra */

  width: 18px;
  height: 18px;
  min-width: 18px;

  display: none;     /* viene mostrato via JS */
  align-items: center;
  justify-content: center;

  background: #ff3b30;
  color: #fff;

  font-size: 10px;
  font-weight: 800;
  line-height: 18px;

  border-radius: 999px;   /* super tondo */
  border: none;           /* niente bordo bianco */

  box-shadow: 0 2px 6px rgba(0,0,0,0.25);

  z-index: 2;
  pointer-events: none;
}



#menu-notifiche{
  display: inline-flex;
  align-items: center;
  gap: 8px;              /* distanza tra testo e badge */
}

/* üîµ BADGE BLU */
#menu-notifiche .badge{
  display: inline-flex;
  align-items: center;
  justify-content: center;

  height: 18px;
  min-width: 18px;
  padding: 0 6px;

  font-size: 10px;
  font-weight: 800;

  border-radius: 999px;

  background: #007aff;   /* blu iOS */
  color: #fff;

  line-height: 1;

  box-shadow: 0 3px 8px rgba(0,122,255,.35);
}

.hero-video{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
  opacity:0;
  transition: opacity 1s ease;
  pointer-events:none;
}

.hero-video.active{
  opacity:1;
}

  </style>

  <link rel="stylesheet" href="bottom-nav.css">
</head>

<body>
<div id="site-wrapper">

<!-- üîù BARRA FISSA -->
<div id="top-fixed-bar">

  <button id="menu-btn" aria-label="Menu">‚ò∞</button>

  <a href="home.html" class="home-btn">
    <img src="tastohome.png" alt="home">
  </a>

  <!-- AVATAR TOP RIGHT -->
<div class="profile-actions top-right">
  <button id="profile-avatar-btn" class="avatar-btn" aria-label="Menu profilo">
    <div class="profile-avatar" id="profile-avatar">
      <span id="profile-avatar-text">?</span>
    </div>

    <!-- BADGE -->
    <span id="profile-notif-badge">0</span>
  </button>
</div>

</div>

<!-- MENU PROFILO -->
<div id="profile-menu" class="glass-menu">
    <button class="glass-item" id="menu-notifiche">
    Vai al profilo 
    <span id="notifiche-count" class="badge" style="display:none;">0</span>
  </button>
  <button class="glass-item" id="menu-change-photo">Cambia immagine</button>
  <button class="glass-item" id="menu-edit-profile">Modifica profilo</button>
  <button class="glass-item" id="menu-register">Registrati</button>
  <a href="login.html" class="glass-item">Accedi</a>
  <button class="glass-item" id="menu-logout">Logout</button>
  <a href="privacy.html" class="glass-item">Privacy &amp; Dati personali</a>
</div>

<div id="profile-menu-backdrop" class="glass-backdrop"></div>




<div id="top-fixed-spacer"></div>

<!-- üîî AVVISO SITO -->
<div id="site-alert">
  <div class="alert-track">
    <span id="site-alert-text"></span>
  </div>
</div>


<button id="scroll-top-btn" aria-label="Torna su">
  ‚Üë
</button>



<section class="hero">
  <img src="img/hero-gelato.jpg" class="hero-img" alt="Gelato artigianale">

  <div class="hero-content reveal">
    <p>
      Crea la tua coppa. Vivi l‚Äôesperienza.
    </p>

    <a href="crea-coppa.html" class="hero-btn">
      Crea Coppa
    </a>
  </div>

<button class="hero-plus-btn" data-hero="coppa">
  <svg viewBox="0 0 24 24" aria-hidden="true">
    <line x1="12" y1="6" x2="12" y2="18"></line>
    <line x1="6" y1="12" x2="18" y2="12"></line>
  </svg>
</button>
</section>



<section class="hero hero-after-coppa">
<video id="hero-menu-video-1" class="hero-img hero-video active" muted playsinline preload="auto">
  <source src="img/menu-video-1.mp4" type="video/mp4">
</video>

<video id="hero-menu-video-2" class="hero-img hero-video" muted playsinline preload="auto">
  <source src="img/menu-video-2.mp4" type="video/mp4">
</video>

  <div class="hero-content reveal">
    <p>
      Scopri tutti i nostri gusti e ingredienti.
    </p>

    <a href="menu.html" class="hero-btn">
      Vai al Menu
    </a>
  </div>

<button class="hero-plus-btn" data-hero="menu">
  <svg viewBox="0 0 24 24" aria-hidden="true">
    <line x1="12" y1="6" x2="12" y2="18"></line>
    <line x1="6" y1="12" x2="18" y2="12"></line>
  </svg>
</button>
</section>



<section class="hero hero-after-menu hero-lavora">
  <img src="img/hero-lavora.jpg" class="hero-img" alt="Lavora con noi">

  <div class="hero-content reveal">
    <p class="hero-sub">
      Entra a far parte del team Casa del Gelato
    </p>

    <a href="lavora-con-noi.html" class="hero-btn">
      Lavora con noi
    </a>
  </div>

  <button class="hero-plus-btn" data-hero="lavora">
  <svg viewBox="0 0 24 24" aria-hidden="true">
    <line x1="12" y1="6" x2="12" y2="18"></line>
    <line x1="6" y1="12" x2="18" y2="12"></line>
  </svg>
</button>
</section>

<section class="hero hero-info">

  <video
    id="hero-info-video"
    class="hero-img"
    muted
    playsinline
    loop
    preload="auto"
  >
    <source src="img/info-contatti.mp4" type="video/mp4">
  </video>

  <div class="hero-content reveal">
    <p>Orari, indirizzi e tutto quello che ti serve.</p>

    <a href="info-contatti.html" class="hero-btn">
      Info & Contatti
    </a>
  </div>

 <button class="hero-plus-btn" data-hero="info">
  <svg viewBox="0 0 24 24" aria-hidden="true">
    <line x1="12" y1="6" x2="12" y2="18"></line>
    <line x1="6" y1="12" x2="18" y2="12"></line>
  </svg>
</button>
</section>



<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAEO7AonQeZ9SsgXd1Ymw2NZW-Pg4mI8E8",
    authDomain: "casadelgelato-db282.firebaseapp.com",
    projectId: "casadelgelato-db282",
    storageBucket: "casadelgelato-db282.firebasestorage.app",
    messagingSenderId: "121009770190",
    appId: "1:121009770190:web:81b82b82cc9bdb686cca9f"
  };

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();
</script>




<script>
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("SW registrato"))
        .catch(err => console.error("SW errore:", err));
}
</script>

<script>
// Nasconde il tasto "Coppe create" se NON sei registrato
document.addEventListener("DOMContentLoaded", () => {
    const logged = localStorage.getItem("userLogged") === "1";
    const btnCrono = document.getElementById("btn-cronologia");

    if (!logged && btnCrono) {
        btnCrono.style.display = "none";
    }
});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
    const isLogged = localStorage.getItem("userLogged") === "1";
    const btn = document.getElementById("btn-disiscriviti");

    // Se NON sei registrato ‚Üí nascondi il tasto
    if (!isLogged) {
        if (btn) btn.style.display = "none";
    }
});
</script>



</div>



<div id="menu-overlay" style="
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.35);
  opacity:0;
  pointer-events:none;
  transition:.25s;
  z-index:10000;
"></div>

<div id="menu-dropdown" style="
  position:fixed;
  top:60px;
  left:14px;
  width:220px;
  background:#fff;
  border-radius:14px;
  box-shadow:0 12px 30px rgba(0,0,0,0.25);
  padding:10px;
  opacity:0;
  pointer-events:none;
  transform:translateY(-10px);
  transition:.25s;
  z-index:10002;
">
<a href="crea-coppa.html" class="menu-item menu-new-only">
  <span class="badge-new-left">NEW</span>
  <span>Crea Coppa</span>
</a>
<a href="home.html" class="menu-item">
  <svg class="menu-icon" viewBox="0 0 24 24" aria-hidden="true">
    <path d="M3 11.5L12 4l9 7.5" />
    <path d="M5 10.5V20a1 1 0 0 0 1 1h4v-6h4v6h4a1 1 0 0 0 1-1v-9.5" />
  </svg>
  <span>Home</span>
</a>
  <a href="menu.html" class="menu-item">
  <svg class="menu-icon" viewBox="0 0 24 24" aria-hidden="true">
    <rect x="6" y="4" width="12" height="16" rx="2"
          fill="none" stroke="currentColor" stroke-width="2"/>
    <line x1="9" y1="9" x2="15" y2="9"
          stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    <line x1="9" y1="13" x2="15" y2="13"
          stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    <line x1="9" y1="17" x2="13" y2="17"
          stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
  </svg>
  <span>Menu</span>
</a>
<a href="profilo.html" class="menu-item">
  <svg class="menu-icon" viewBox="0 0 24 24" aria-hidden="true">
    <path d="M12 12c2.761 0 5-2.239 5-5S14.761 2 12 2 7 4.239 7 7s2.239 5 5 5zm0 2c-4.418 0-8 2.239-8 5v1h16v-1c0-2.761-3.582-5-8-5z"/>
  </svg>
  <span>Profilo</span>
</a>
<a href="info-contatti.html" class="menu-item">
  <svg class="menu-icon" viewBox="0 0 24 24" aria-hidden="true">
    <!-- CERCHIO -->
    <circle
      cx="12"
      cy="12"
      r="9"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
    />

    <!-- PALLINO DELLA i -->
    <circle
      cx="12"
      cy="8"
      r="0.5"
      fill="currentColor"
    />

    <!-- STELO DELLA i -->
    <line
      x1="12"
      y1="11"
      x2="12"
      y2="17"
      stroke="currentColor"
      stroke-width="2.2"
      stroke-linecap="round"
    />
  </svg>
  <span>Info &amp; Contatti</span>
</a>
<a href="lavora-con-noi.html" class="menu-item">
  <svg class="menu-icon" viewBox="0 0 24 24" aria-hidden="true">
    <!-- corpo valigetta -->
    <rect x="3" y="7" width="18" height="13" rx="2"
          fill="none" stroke="currentColor" stroke-width="2"/>
    <!-- manico -->
    <path d="M9 7V5a3 3 0 0 1 6 0v2"
          fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round"/>
  </svg>
  <span>Lavora con noi</span>
</a>
</div>

<script>
  const menuBtn = document.getElementById("menu-btn");
  const menu = document.getElementById("menu-dropdown");
  const overlay = document.getElementById("menu-overlay");

  function openMenu(){
    menu.classList.add("open");
    menu.style.opacity = "1";
    menu.style.pointerEvents = "auto";
    menu.style.transform = "translateY(0)";

    overlay.style.opacity = "1";
    overlay.style.pointerEvents = "auto";
  }

  function closeMenu(){
    menu.classList.remove("open");
    menu.style.opacity = "0";
    menu.style.pointerEvents = "none";
    menu.style.transform = "translateY(-10px)";

    overlay.style.opacity = "0";
    overlay.style.pointerEvents = "none";
  }

  menuBtn.addEventListener("click", () => {
    const isOpen = menu.classList.contains("open");
    isOpen ? closeMenu() : openMenu();
  });

  overlay.addEventListener("click", closeMenu);

  // chiude con ESC
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closeMenu();
  });

  // chiude quando clicchi un link del menu
  menu.querySelectorAll("a").forEach(a => {
    a.addEventListener("click", closeMenu);
  });
</script>

<footer class="profile-footer">
  <div class="footer-links">
    <a href="privacy.html">Privacy</a> ¬∑
    <a href="termini.html">Termini</a> ¬∑
    <a href="cookie.html">Cookie</a>
  </div>

  <div class="footer-copy">
    ¬© 2026 Casa del Gelato
  </div>

  <div class="footer-version">
    Versione 1.0.0
  </div>
</footer>

<script>
const observer = new IntersectionObserver(entries => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      entry.target.classList.add("in-view");
    }
  });
}, { threshold: 0.4 });

document.querySelectorAll(".reveal").forEach(el => {
  observer.observe(el);
});
</script>




<script>
(() => {
  const btn = document.getElementById("scroll-top-btn");

  function checkScroll(){
    const scrollY = window.scrollY;
    const docH = document.documentElement.scrollHeight;
    const winH = window.innerHeight;

    // mostra SOLO quando sei quasi in fondo
    if (scrollY + winH > docH - 300){
      btn.classList.add("show");
    } else {
      btn.classList.remove("show");
    }
  }

  window.addEventListener("scroll", checkScroll, { passive: true });

  btn.addEventListener("click", () => {
    window.scrollTo({
      top: 0,
      behavior: "smooth"
    });
  });
})();
</script>





<script type="module">
import { supabase } from "./supabase.js";

const SESSION_KEY = "cdg_session_id";
const PING_EVERY = 15000; // 15s
let sessionId = localStorage.getItem(SESSION_KEY);

if (!sessionId) {
  sessionId = crypto.randomUUID();
  localStorage.setItem(SESSION_KEY, sessionId);
}

async function pingOnline() {
  const { error } = await supabase
    .from("online_users")
    .upsert({
      session_id: sessionId,
      last_seen: new Date().toISOString()
    }, {
      onConflict: "session_id"
    });

  if (error) {
    console.warn("online ping error", error.message);
  }
}

// ping subito
pingOnline();

// ping periodico
setInterval(pingOnline, PING_EVERY);

// ping quando la pagina torna visibile
document.addEventListener("visibilitychange", () => {
  if (!document.hidden) pingOnline();
});
</script>


<script type="module">
import { supabase } from "./supabase.js";

const alertBox  = document.getElementById("site-alert");
const alertText = document.getElementById("site-alert-text");

/* üî• FIX TIMEZONE */
function parseTs(ts){
  if (!ts) return null;
  // se manca la Z ‚Üí lo tratto come UTC (perch√© lo salvi con toISOString)
  return new Date(ts.endsWith("Z") ? ts : ts + "Z");
}

async function loadSiteAlert() {
  if (!alertBox || !alertText) return;

  alertBox.style.display = "none";

  const { data, error } = await supabase
    .from("site_alert")
    .select("*")
    .eq("id", 1)
    .single();

  if (error || !data) return;

  const nowMs = Date.now();
  const startMs = data.start_at ? Date.parse(data.start_at) : null;
  const endMs   = data.end_at   ? Date.parse(data.end_at)   : null;

  // üîí BLOCCO ASSOLUTO
  if (!data.enabled) return;
  if (startMs && nowMs < startMs) return;   // ‚¨ÖÔ∏è QUESTO ERA IL BUCO
  if (endMs && nowMs > endMs) return;

  alertText.textContent = data.text || "";
  alertBox.style.display = "flex";
}

// carica al load
window.addEventListener("load", () => {
  setTimeout(loadSiteAlert, 300);
});

// üî¥ REALTIME
supabase
  .channel("site-alert-live")
  .on(
    "postgres_changes",
    {
      event: "UPDATE",
      schema: "public",
      table: "site_alert"
    },
    () => {
      loadSiteAlert();
    }
  )
  .subscribe();
  // ‚è±Ô∏è ricontrolla ogni 30 secondi (solo orario)
setInterval(() => {
  loadSiteAlert();
}, 10000);
</script>



<script>
function chiudiAvviso(){
  const alert = document.getElementById("site-alert");
  if (alert) alert.style.display = "none";
}
</script>

<!-- üç® POPUP BENVENUTO -->
<div id="popup-benvenuto" class="popup-overlay" style="display:none">
  <div class="popup-box">

    <h2 style="
      font-size:22px;
      font-weight:800;
      margin-bottom:14px;
      letter-spacing:-0.3px;
    ">
      Benvenuto in <b>Casa del Gelato</b>
    </h2>

    <p style="
      font-size:15.5px;
      line-height:1.5;
      color:#333;
      margin-bottom:16px;
    ">
      Scopri il nostro <b>menu</b>, tutte le <b>info utili</b><br>
      e personalizza la tua <b>coppa</b> come desideri.
    </p>

    <p style="
      font-size:15px;
      font-weight:600;
      margin-bottom:6px;
    ">
      Registrandoti puoi:
    </p>

    <p style="
      font-size:15px;
      line-height:1.6;
      color:#333;
      margin-bottom:16px;
    ">
      ‚Ä¢ personalizzare le coppe<br>
      ‚Ä¢ salvare i tuoi preferiti<br>
      ‚Ä¢ accedere a <b>coupon e vantaggi esclusivi</b>
    </p>

<div class="welcome-hide-row">
  <label>
    <input type="checkbox" id="welcome-hide-forever">
    <span>Non mostrare pi√π</span>
  </label>
</div>

    <div class="popup-actions">
      <button class="popup-btn secondary" onclick="chiudiPopupBenvenuto()">
        Chiudi
      </button>

   <button class="popup-btn primary" onclick="vaiAllaRegistrazione()">
  Registrati
</button>
    </div>
  </div>
</div>

<script>
function chiudiPopupBenvenuto(){
  const popup = document.getElementById("popup-benvenuto");
  const checkbox = document.getElementById("welcome-hide-forever");

  if (!popup) return;

  // ‚úÖ salva preferenza
  if (checkbox && checkbox.checked) {
    localStorage.setItem("hideWelcomePopup", "1");
  }

  popup.style.display = "none";
  document.body.classList.remove("popup-open");
  document.body.style.overflow = "";
}

function vaiAllaRegistrazione(){
  chiudiPopupBenvenuto();
  window.location.href = "/login?mode=register";
}
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const hide = localStorage.getItem("hideWelcomePopup") === "1";
  const isLogged = localStorage.getItem("userLogged") === "1";

  if (hide || isLogged) return;

  const popup = document.getElementById("popup-benvenuto");
  if (!popup) return;

  popup.style.display = "flex";
  document.body.classList.add("popup-open");
  document.body.style.overflow = "hidden";
});
</script>

<!-- GOOGLE TRANSLATE (invisibile) -->
<div id="google_translate_element" style="display:none;"></div>

<script>
/* ===============================
   üåç GOOGLE TRANSLATE INIT
=============================== */
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
    pageLanguage: 'it',
    includedLanguages: 'it,en,de',
    autoDisplay: false
  }, 'google_translate_element');
}

/* ===============================
   üîó BRIDGE: forza lingua
=============================== */
function setGoogleLang(lang){
  const combo = document.querySelector(".goog-te-combo");
  if (!combo) {
    console.warn("Google Translate non pronto");
    return;
  }
  combo.value = lang;
  combo.dispatchEvent(new Event("change"));
}
</script>



<script>
/* ===============================
   üáÆüáπ üá¨üáß üá©üá™ LANGUAGE MENU
=============================== */
document.addEventListener("DOMContentLoaded", () => {
  const toggle  = document.getElementById("lang-toggle");
  const menu    = document.getElementById("lang-menu");
  const buttons = document.querySelectorAll(".lang-btn");

  if (!toggle || !menu || !buttons.length) return;

  const FLAGS = {
    it: "üáÆüáπ",
    en: "üá¨üáß",
    de: "üá©üá™"
  };

  // üîΩ toggle menu
  toggle.addEventListener("click", e => {
    e.stopPropagation();
    menu.classList.toggle("open");
  });

  // ‚ùå click fuori ‚Üí chiudi
  document.addEventListener("click", () => {
    menu.classList.remove("open");
  });

  menu.addEventListener("click", e => e.stopPropagation());

  // üåç click lingua
  buttons.forEach(btn => {
    btn.addEventListener("click", () => {
      const lang = btn.dataset.lang;

      localStorage.setItem("lang", lang);
      toggle.textContent = FLAGS[lang] + " ‚ñæ";
      menu.classList.remove("open");

      setGoogleLang(lang);
    });
  });

  // üîÅ ripristino lingua salvata
  const saved = localStorage.getItem("lang") || "it";
  toggle.textContent = FLAGS[saved] + " ‚ñæ";

  // ‚è≥ attende Google e applica
  setTimeout(() => setGoogleLang(saved), 800);
});
</script>






<script>
(function () {
  function fixIOSViewport() {
    const height = window.visualViewport
      ? window.visualViewport.height
      : window.innerHeight;

    document.documentElement.style.setProperty(
      '--real-vh',
      `${height}px`
    );
  }

  fixIOSViewport();

  if (window.visualViewport) {
    window.visualViewport.addEventListener('resize', fixIOSViewport);
  }
  window.addEventListener('orientationchange', fixIOSViewport);
})();
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const video = document.getElementById("hero-info-video");
  if (!video) return;

  // assicuriamo che sia fermo all'inizio
  video.pause();
  video.currentTime = 0;

  setTimeout(() => {
    video.play().catch(() => {});
  }, 5000); // parte dopo 5 secondi
});
</script>

<script>

const avatarBtnProfile = document.getElementById("profile-avatar-btn");
const profileMenu = document.getElementById("profile-menu");
const profileBackdrop = document.getElementById("profile-menu-backdrop");

function openProfileMenu(){
  profileMenu.classList.add("show");
  profileBackdrop.classList.add("show");
}

function closeProfileMenu(){
  profileMenu.classList.remove("show");
  profileBackdrop.classList.remove("show");
}

if (avatarBtnProfile){
  avatarBtnProfile.addEventListener("click", (e) => {
    e.stopPropagation();
    const isOpen = profileMenu.classList.contains("show");
    isOpen ? closeProfileMenu() : openProfileMenu();
  });
}

if (profileBackdrop){
  profileBackdrop.addEventListener("click", closeProfileMenu);
}

window.addEventListener("keydown", (e) => {
  if (e.key === "Escape") closeProfileMenu();
});
</script>

<!-- üçé HERO INFO POPUP -->
<div id="hero-info-popup" class="hero-popup-overlay">
  <div class="hero-popup-card">

    <button class="hero-popup-close" onclick="chiudiHeroPopup()">‚úï</button>

    <div class="hero-popup-content">
      <h2 id="hero-popup-title"></h2>

      <!-- üëá NON pi√π <p> -->
      <div id="hero-popup-text"></div>

      <img id="hero-popup-img" src="" alt="" />

    </div>

  </div>
</div>

<script>
(function initHeroPlusPopup(){

  const heroInfoData = {

coppa: {
  title: "Benvenuto in <span class='accent'>Scoopy Ice</span>",
text: `
  <div class="popup-hero">
    <div class="popup-lead">
      Non scegli un gelato.
    </div>
    <div class="popup-big">
      Lo crei.
    </div>
  </div>

  <div class="popup-card">
    <strong>Scoopy ice</strong> √® la nostra esperienza digitale
    che ti permette di costruire la tua coppa
    esattamente come la immagini.
  </div>

  <div class="popup-steps-card">
    <div>‚ú® Scegli il formato</div>
    <div>üç® Seleziona i gusti</div>
    <div>üç´ Aggiungi topping, ingredienti ed extra</div>
    <div>üöÄ Condividi la tua coppa</div>
  </div>

  <div class="popup-card">
    Puoi farlo comodamente <strong>da casa</strong>
    e arrivare gi√† pronto per ordinare,
    senza perdere tempo.
  </div>

  <div class="popup-card subtle">
    Sei in gelateria e non sai come funziona?
    Prima di scegliere il tavolo trovi
    un <strong>tasto dedicato</strong> che ti guida passo dopo passo.
  </div>

<div class="popup-final">
  Ogni coppa √® diversa.
  <br><strong>La tua sar√† unica.</strong>
  <br><br>
  <a href="crea-coppa.html" class="popup-inline-cta">
    Inizia ora
  </a>
</div>
`,
  img: "img/hero-gelato.jpg",
  cta: true
},
menu: {
  title: "Il Nostro Menu",
  text: `
    <div class="popup-hero">
      <div class="popup-lead">
        Tutto quello che vendiamo.
      </div>
      <div class="popup-big">
        In un unico posto.
      </div>
    </div>

    <div class="popup-card">
      Nel menu trovi <strong>gelati, coppe, bevande e specialit√†</strong>
      sempre aggiornate, con descrizioni chiare e dettagliate.
    </div>

    <div class="popup-steps-card">
      <div>üç® Vedi tutti i prodotti disponibili</div>
      <div>‚ö†Ô∏è Consulta allergeni e ingredienti</div>
      <div>üìù Aggiungi prodotti alla tua lista</div>
    </div>

    <div class="popup-card">
      Puoi creare una <strong>lista completa</strong> e mostrarla
      al cameriere per ordinare tutto in un‚Äôunica volta,
      in modo semplice e veloce.
    </div>

    <div class="popup-final">
      Decidi con calma.<br>
      <strong>Ordina senza confusione.</strong>
      <br><br>
      <a href="menu.html" class="popup-inline-link">Apri il menu</a>
    </div>
  `,
  img: "img/hero-menu.jpg"
},

lavora: {
  title: "Lavora con Noi",
  text: `
    <div class="popup-hero">
      <div class="popup-lead">
        Non √® solo un lavoro.
      </div>
      <div class="popup-big">
        √à energia, sorriso, squadra.
      </div>
    </div>

    <div class="popup-card">
      In Casa del Gelato cerchiamo persone
      <strong>solari, dinamiche e affidabili</strong>,
      con voglia di mettersi in gioco
      e far vivere un‚Äôesperienza speciale ai clienti.
    </div>

    <div class="popup-steps-card">
      <div>ü§ù Lavoro di squadra</div>
      <div>‚ö°Ô∏è Velocit√†, ritmo e spirito attivo</div>
      <div>‚ù§Ô∏è Cura dei dettagli e del servizio</div>
    </div>

    <div class="popup-card subtle">
      Anche senza esperienza?
      Se hai entusiasmo e voglia di imparare,
      per noi conta pi√π l‚Äôattitudine.
    </div>

    <div class="popup-final">
      Vuoi far parte del team?
      <br><strong>Inizia il tuo percorso con noi.</strong>
      <br><br>
      <a href="lavora-con-noi.html" class="popup-inline-link">
        Invia la candidatura
      </a>
    </div>
  `,
  img: "img/hero-lavora.jpg"
},

info: {
  title: "Info & Contatti",
  text: `
    <div class="popup-hero">
      <div class="popup-lead">
        Tutto quello che ti serve.
      </div>
      <div class="popup-big">
        A portata di mano.
      </div>
    </div>

    <div class="popup-card">
      Qui trovi tutti i nostri <strong>contatti ufficiali</strong>:
      numero di telefono, email e collegamenti diretti ai
      <strong>profili social</strong>.
    </div>

    <div class="popup-steps-card">
      <div>üìç Indirizzi e indicazioni stradali</div>
      <div>üïí Orari aggiornati</div>
      <div>üìû Contatti rapidi</div>
      <div>‚≠ê Lasciaci una recensione </div>
    </div>

    <div class="popup-card">
      Scopri informazioni sui nostri locali,
      cosa trovi nelle vicinanze e tutto ci√≤ che pu√≤
      rendere la tua visita ancora pi√π semplice.
    </div>

    <div class="popup-final">
      Un solo spazio.<br>
      <strong>Tutte le informazioni.</strong><br><br>

      <a href="info-contatti.html" class="popup-inline-link">
        Vai alla pagina Info & Contatti
      </a>
    </div>
  `,
  img: "img/hero-info.jpg"
}
};

  const popup     = document.getElementById("hero-info-popup");
  const title     = document.getElementById("hero-popup-title");
  const text      = document.getElementById("hero-popup-text");
  const img       = document.getElementById("hero-popup-img");
  const startBtn  = document.getElementById("popup-start-btn");

  if (!popup) return;

  let currentKey = null;

  function openPopup(key){

    const data = heroInfoData[key];
    if (!data) return;

    currentKey = key;

    title.innerHTML = data.title;
    text.innerHTML  = data.text;
    const content = popup.querySelector(".hero-popup-content");
if (content) content.scrollTop = 0;

    if (img && data.img){
      img.src = data.img;
      img.style.display = "block";
    }

    if (startBtn){
      if (data.cta){
        startBtn.style.display = "block";
        startBtn.href = "crea-coppa.html";
      } else {
        startBtn.style.display = "none";
      }
    }

    popup.classList.add("show");
    document.body.classList.add("popup-open");
  }

function closePopup(){
  popup.classList.remove("show");
  document.body.classList.remove("popup-open");
}

  // click sui +
  document.querySelectorAll(".hero-plus-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      openPopup(btn.dataset.hero);
    });
  });

  // chiudi con X
  window.chiudiHeroPopup = closePopup;

  // chiudi cliccando fuori
  popup.addEventListener("click", (e) => {
    if (e.target === popup){
      closePopup();
    }
  });

  // chiudi con ESC
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape"){
      closePopup();
    }
  });

})();
</script>

</div>


<script type="module">
import { supabase } from "./supabase.js";


async function aggiornaAvatarHome(){

  const email  = localStorage.getItem("user_email");
  const logged = localStorage.getItem("userLogged") === "1";

  const avatar  = document.getElementById("profile-avatar");
  const text    = document.getElementById("profile-avatar-text");

  if (!avatar) return;

  // reset base
  avatar.style.backgroundImage = "";
  avatar.style.background = "#fff";
  avatar.style.border = "1px solid rgba(0,0,0,0.08)";

  if (text) text.style.display = "block";

  // ‚ùå NON LOGGATO
  if (!logged || !email){
    if (text) text.textContent = "?";
    return;
  }

  // üîπ carica avatar da Supabase
  const { data, error } = await supabase
    .from("utenti")
    .select("avatar_url")
    .eq("email", email)
    .single();

  if (!error && data?.avatar_url){
    avatar.style.backgroundImage = `url(${data.avatar_url})`;
    avatar.style.backgroundSize = "contain";
    avatar.style.backgroundPosition = "center";
    avatar.style.backgroundRepeat = "no-repeat";

    if (text) text.style.display = "none";
    return;
  }

  // fallback iniziale email
  if (text){
    text.textContent = email.charAt(0).toUpperCase();
  }
}

document.addEventListener("DOMContentLoaded", aggiornaAvatarHome);
document.addEventListener("DOMContentLoaded", setupAvatarChangeHome);
document.addEventListener("DOMContentLoaded", () => {

  const editBtn     = document.getElementById("menu-edit-profile");
  const registerBtn = document.getElementById("menu-register");
  const loginBtn    = document.querySelector('#profile-menu a[href="login.html"]');

  // üîµ MODIFICA PROFILO
  if (editBtn){
    editBtn.addEventListener("click", () => {
      closeProfileMenu();
      window.location.href = "/modifica-profilo.html";
    });
  }

  // üü† REGISTRATI
  if (registerBtn){
    registerBtn.addEventListener("click", () => {
      closeProfileMenu();
      window.location.href = "/login.html?mode=register";
    });
  }

  // üü¢ ACCEDI
  if (loginBtn){
    loginBtn.addEventListener("click", (e) => {
      e.preventDefault();
      closeProfileMenu();
      window.location.href = "/login.html";
    });
  }

});


async function aggiornaDotNotificheHome(){

  const email  = localStorage.getItem("user_email");
  const logged = localStorage.getItem("userLogged") === "1";

  const avatarBadge = document.getElementById("profile-notif-badge");
  const menuBadge   = document.getElementById("notifiche-count");

  // ‚ùå NON LOGGATO
  if (!logged || !email){
    if (avatarBadge) avatarBadge.style.display = "none";
    if (menuBadge)   menuBadge.style.display   = "none";
    return;
  }

const { data, error } = await supabase
  .from("notifiche")
  .select("id")
  .eq("email", email)
  .eq("letta", false);

console.log("üîé NOTIFICHE TROVATE:", data);
console.log("üìä NUMERO:", data?.length);

  if (error){
    if (avatarBadge) avatarBadge.style.display = "none";
    if (menuBadge)   menuBadge.style.display   = "none";
    return;
  }

  const n = data.length;

  if (n > 0){

    const value = n > 99 ? "99+" : n;

    // üî¥ badge avatar
    if (avatarBadge){
      avatarBadge.textContent = value;
      avatarBadge.style.display = "flex";
    }

    // üî¥ badge nel bottone "Vai al profilo"
    if (menuBadge){
      menuBadge.textContent = value;
      menuBadge.style.display = "inline-flex";
    }

  } else {

    if (avatarBadge) avatarBadge.style.display = "none";
    if (menuBadge)   menuBadge.style.display   = "none";

  }
}
document.addEventListener("DOMContentLoaded", aggiornaDotNotificheHome);
document.addEventListener("DOMContentLoaded", async () => {
  const email  = localStorage.getItem("user_email");
  const logged = localStorage.getItem("userLogged") === "1";

  if (logged && email){
    await aggiornaDotNotificheHome();   // üî• carica subito
    subscribeNotificheHome(email);      // üîî realtime
  }
});


function subscribeNotificheHome(email){

  supabase
    .channel("notifiche-home-realtime")
    .on(
      "postgres_changes",
      {
        event: "*",
        schema: "public",
        table: "notifiche",
        filter: `email=eq.${email}`
      },
      async (payload) => {
        console.log("üîî HOME REALTIME:", payload);
        await aggiornaDotNotificheHome();
      }
    )
    .subscribe((status) => {
      console.log("üì° HOME SUB STATUS:", status);
    });
}

function setupAvatarChangeHome(){

  const changeBtn = document.getElementById("menu-change-photo");
  const input     = document.getElementById("profile-avatar-input");

  if (!changeBtn || !input) return;

  // üîµ CLICK SU "CAMBIA IMMAGINE"
  changeBtn.addEventListener("click", () => {

    const email  = localStorage.getItem("user_email");
    const logged = localStorage.getItem("userLogged") === "1";

    if (!logged || !email){
      mostraPopup(
        "Accesso richiesto",
        "Accedi o registrati per modificare l‚Äôimmagine profilo.",
        "login.html"
      );
      return;
    }

    input.click();
  });

  // üü¢ QUANDO SELEZIONI FILE
  input.addEventListener("change", async () => {

    const email  = localStorage.getItem("user_email");
    const logged = localStorage.getItem("userLogged") === "1";

    if (!logged || !email){
      input.value = "";
      return;
    }

    const file = input.files?.[0];
    if (!file) return;

    try {

      const bitmap = await createImageBitmap(file);

      let w = bitmap.width;
      let h = bitmap.height;

      const maxSize = 256;
      const scale = Math.min(maxSize / w, maxSize / h, 1);

      w = Math.round(w * scale);
      h = Math.round(h * scale);

      const canvas = document.createElement("canvas");
      canvas.width = w;
      canvas.height = h;

      const ctx = canvas.getContext("2d");
      ctx.drawImage(bitmap, 0, 0, w, h);

      const dataUrl = canvas.toDataURL("image/jpeg", 0.82);
      const fileName = `avatar_${email.replace(/[@.]/g,"_")}.jpg`;
      const blob = await (await fetch(dataUrl)).blob();

      const { error: uploadError } = await supabase
        .storage
        .from("avatars")
        .upload(fileName, blob, {
          upsert: true,
          contentType: "image/jpeg"
        });

      if (uploadError){
        mostraPopup("Errore", "Errore nel caricamento immagine");
        return;
      }

      const { data } = supabase
        .storage
        .from("avatars")
        .getPublicUrl(fileName);

      const avatarUrl = data.publicUrl + "?t=" + Date.now();

      await supabase
        .from("utenti")
        .update({ avatar_url: avatarUrl })
        .eq("email", email);

      aggiornaAvatarHome();

    } catch (err){
      console.error(err);
      mostraPopup("Errore", "Si √® verificato un problema.");
    }

  });
}

document.addEventListener("DOMContentLoaded", () => {

  const logoutBtn = document.getElementById("menu-logout");
  if (!logoutBtn) return;

  logoutBtn.addEventListener("click", async () => {

    try {
      // üîê Logout Supabase
      await supabase.auth.signOut();
    } catch (err) {
      console.warn("Errore logout supabase:", err);
    }

    // üßπ Pulisce localStorage
    localStorage.removeItem("userLogged");
    localStorage.removeItem("user_email");

    // üîî Nasconde badge notifiche
    const badge = document.getElementById("profile-notif-badge");
    if (badge) badge.style.display = "none";

    // üë§ Reset avatar
    aggiornaAvatarHome();

    // ‚ùå Chiude menu
    closeProfileMenu();

    // üîÑ Redirect alla home ufficiale
    window.location.href = "/home.html";
  });

});

document.addEventListener("DOMContentLoaded", () => {

  const btn = document.getElementById("menu-notifiche");
  const popup = document.getElementById("notifiche-popup");
  const backdrop = document.getElementById("notifiche-backdrop");
  const closeBtn = document.getElementById("chiudi-notifiche");

  if (!btn || !popup || !backdrop || !closeBtn) return;

  async function apriNotifiche(){
    closeMenu?.();

    const email = localStorage.getItem("user_email");
    if (!email){
      mostraPopup(
        "Accesso richiesto",
        "Accedi o registrati per visualizzare le notifiche.",
        "login.html"
      );
      return;
    }

    await caricaNotificheUtente();   // üëà usa stessa funzione

    document.body.classList.add("no-scroll");
    backdrop.classList.add("show");
    popup.classList.add("show");
  }

  async function chiudiNotifiche(){
    popup.classList.remove("show");
    backdrop.classList.remove("show");
    document.body.classList.remove("no-scroll");

    const email = localStorage.getItem("user_email");
    if (!email) return;

    await supabase
      .from("notifiche")
      .update({ letta: true })
      .eq("email", email)
      .eq("letta", false);

    aggiornaBadgeNotifiche();
  }

  closeBtn.addEventListener("click", chiudiNotifiche);
  backdrop.addEventListener("click", chiudiNotifiche);
});

document.addEventListener("DOMContentLoaded", () => {

  const notifBtn = document.getElementById("menu-notifiche");

  if (notifBtn) {
    notifBtn.addEventListener("click", () => {
      closeMenu(); // chiude menu profilo

      // üî• redirect diretto al profilo
      window.location.href = "profilo.html";
    });
  }

});

</script>

<input
  id="profile-avatar-input"
  type="file"
  accept="image/*"
  style="
    position: fixed;
    left: -9999px;
    opacity: 0;
    pointer-events: none;
  "
>


<script>
document.addEventListener("DOMContentLoaded", () => {

  const v1 = document.getElementById("hero-menu-video-1");
  const v2 = document.getElementById("hero-menu-video-2");

  if (!v1 || !v2) return;

  let current = v1;
  let next    = v2;

  function switchVideo() {

    next.currentTime = 0;
    next.play().catch(()=>{});

    next.classList.add("active");
    current.classList.remove("active");

    // swap riferimenti
    [current, next] = [next, current];
  }

  v1.addEventListener("ended", switchVideo);
  v2.addEventListener("ended", switchVideo);

  // parte il primo
  v1.play().catch(()=>{});

});
</script>

</body>
</html>