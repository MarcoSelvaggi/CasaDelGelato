<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>Casa del Gelato</title>
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="icon" href="favicon.png">
  <link rel="apple-touch-icon" href="icon-192.png">
  <script src="global.js"></script>


  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;margin:0;background:#f6f6f7;color:#111}
    header{text-align:center;padding:22px}

    /* Spazio sotto per non schiacciare la bottom bar */
body {
    padding-bottom: 90px;
}
/* Protezione icone bottom nav */
#bottom-nav img {
    width: 26px !important;
    height: 26px !important;
    object-fit: contain !important;
}
    /* üîù BARRA FISSA + HOME */
    #top-fixed-bar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 55px;
      display: flex;
      justify-content: center;
      align-items: center;
      background: white;
      border-bottom: 1px solid #ddd;
      z-index: 9999;
    }

    .home-btn {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 17px;
        color: #444;
        text-decoration: none;
    }

    .home-btn img {
        width: 28px;
        height: 28px;
    }

    /* spazio per far scendere il contenuto */
    #top-fixed-spacer {
      height: 55px;
      width: 100%;
    }
    /* Tasto Lavora con Noi (solo in index) */
.jobs-btn {
    position: absolute;
    left: 12px;
    top: 13px;
    padding: 6px 10px;
    background: #ff7a00;
    color: white;
    font-size: 14px;
    border-radius: 10px;
    text-decoration: none;
    font-weight: 600;
    z-index: 9999;
}

    /* LANGUAGE MENU */
    #lang-toggle{
      position:fixed; 
      top:14px; 
      right:14px;
      padding:6px 12px;
      border-radius:12px;
      background:white;
      border:1px solid #ddd;
      cursor:pointer; 
      font-size:18px;
      z-index:10000;
    }

    #lang-menu{
      position:fixed; 
      top:50px; 
      right:14px;
      background:#fff;
      padding:6px 0;
      border-radius:10px;
      box-shadow:0 6px 20px rgba(0,0,0,0.12);
      display:none;
      z-index:10001;
    }

    #lang-menu button{
      padding:10px 16px;
      border:none;
      background:transparent;
      cursor:pointer;
      font-size:15px;
      text-align:left;
      width:100%;
    }

    #lang-menu button:hover{background:#f2f2f2;}

    /* BUTTONS */
    .menu-section{padding:22px;text-align:center}
    .btn{
      display:block;width:240px;text-align:center;
      padding:12px 14px;border-radius:12px;background:#ff7a00;color:#fff;
      text-decoration:none;margin:14px auto;font-size:17px;font-weight:600;
    }

    /* CARDS */
    .shop-card {
      background:white;
      padding:16px;
      border-radius:14px;
      margin:14px auto;
      max-width:330px;
      box-shadow:0 2px 6px rgba(0,0,0,0.08);
      text-align:left;
    }
    .shop-card b {font-size:16px;margin-bottom:4px;display:block;}
    .shop-card a {text-decoration:none;margin-top:4px;display:block;font-size:15px;color:#007aff;}

/* ‚ò∞ MENU DROPDOWN */
#menu-dropdown a{
  display:block;
  padding:10px;
  border-radius:10px;
  text-decoration:none;
  color:#111;
  font-size:15px;
}

#menu-dropdown a:hover{
  background:#f2f2f7;
}

.menu-item {
  display: flex !important;
  flex-direction: row !important;
  align-items: center !important;
  gap: 12px;
}

.menu-item svg.menu-icon {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
  stroke: #111;
  stroke-width: 1.8;
  fill: none;
}
.icon-wrapper{
  position: relative;
  display: inline-flex;
  align-items: center;
}

.menu-new-only{
  display: flex;
  align-items: center;
  gap: 12px;
}

.badge-new-left{
  background: #ff3b30;
  color: #fff;
  font-size: 9px;          /* ‚¨ÖÔ∏è pi√π piccolo */
  font-weight: 700;
  padding: 3px 6px;        /* ‚¨ÖÔ∏è meno padding */
  border-radius: 999px;
  line-height: 1;
  letter-spacing: .3px;
}


/* ===============================
   ‚è±Ô∏è WAIT BAR ‚Äì DIMENSIONI BLOCCATE
=============================== */

#wait-bar {
  /* üîí isolamento totale */
  all: unset;
  box-sizing: border-box;

  position: fixed;
  bottom: 90px;
  left: 12px;

  display: none;
  align-items: center;
  justify-content: center;

  background: #111;
  color: #fff;

  /* üî¢ dimensioni IDENTICHE a crea coppa */
  font-family: -apple-system, BlinkMacSystemFont,
               "SF Pro Text", "SF Pro Display",
               system-ui, sans-serif;

  font-size: 12px;
  font-weight: 600;
  line-height: 1;

  padding: 6px 12px;
  border-radius: 11px;

  z-index: 999999;

  /* ‚ùå nessuna scala, mai */
  transform: none !important;
  zoom: 1 !important;
}

/* üîí testo interno */
#wait-bar span {
  all: unset;
  font: inherit;
  color: inherit;
  line-height: inherit;
}

/* testo descrittivo */
#wait-full {
  font-size: 11.5px;
  font-weight: 500;
  opacity: 0.75;
}

/* countdown */
#wait-time,
#wait-mmss {
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 0.2px;
}
/* ‚ò∞ MENU BUTTON ‚Äì PROFILO (identico a HOME) */
#menu-btn{
  position: absolute;
  left: 14px;
  top: 14px;              /* üîí BLOCCATO */
  height: 27px;           /* met√† top bar */
  display: flex;
  align-items: center;

  background: transparent;
  border: none;
  box-shadow: none;
  padding: 0;
  margin: 0;

  font-size: 22px;
  line-height: 1;
  color: #111;

  cursor: pointer;
  z-index: 10001;
}

#menu-btn:active{
  opacity: .6;
}
#menu-btn{
  position: absolute;
  left: 14px;
  top: 50%;
  transform: translateY(-50%);
}
/* ===== FOOTER PROFILO / GLOBALE ===== */
.profile-footer{
  padding: 10px 12px 14px;
  text-align: center;
  font-size: 12px;
  color: #8e8e93;
}

.profile-footer a{
  color:#8e8e93;
  text-decoration:none;
  font-weight:500;
}

.profile-footer a:hover{
  text-decoration:underline;
}

.footer-links{
  margin-bottom:8px;
}

.footer-copy{
  margin-bottom:4px;
}

.footer-version{
  opacity:.6;
}

  </style>
  <link rel="stylesheet" href="bottom-nav.css">
</head>

<body>


<!-- üîù BARRA FISSA -->
<div id="top-fixed-bar">

  <button id="menu-btn" aria-label="Menu">‚ò∞</button>

  <a href="home.html" class="home-btn">
    <img src="tastohome.png" alt="home">
  </a>

</div>

<div id="top-fixed-spacer"></div>


<!-- LANGUAGE -->
<div id="lang-toggle">üáÆüáπ ‚ñæ</div>
<div id="lang-menu">
  <button class="lang-btn" data-lang="it">Italiano</button>
  <button class="lang-btn" data-lang="en">English</button>
  <button class="lang-btn" data-lang="de">Deutsch</button>
</div>

<header><h1 data-lang="title">Casa del Gelato</h1></header>


<section class="menu-section">
  <h2 data-lang="create_cup_title">Crea la tua Coppa</h2>
  <p data-lang="create_cup_subtitle">Personalizza la tua coppa come la vuoi tu</p>
  <a id="start-coppa" class="btn" data-lang="create_button">üç® INIZIA</a>
</section>


<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAEO7AonQeZ9SsgXd1Ymw2NZW-Pg4mI8E8",
    authDomain: "casadelgelato-db282.firebaseapp.com",
    projectId: "casadelgelato-db282",
    storageBucket: "casadelgelato-db282.firebasestorage.app",
    messagingSenderId: "121009770190",
    appId: "1:121009770190:web:81b82b82cc9bdb686cca9f"
  };

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();
</script>

<!-- LANGUAGE LOGIC -->
<script>
(function(){
  const FLAGS = { it:"üáÆüáπ", en:"üá¨üáß", de:"üá©üá™" };
  const LANG = {
    it:{title:"Casa del Gelato",create_cup_title:"Crea la tua Coppa",create_cup_subtitle:"Personalizza la tua coppa come la vuoi tu",create_button:"üç® INIZIA",contacts:"I nostri Locali"},
    en:{title:"House of Gelato",create_cup_title:"Create Your Cup",create_cup_subtitle:"Customize your cup",create_button:"üç® START",contacts:"Our Shops"},
    de:{title:"Haus des Gelatos",create_cup_title:"Erstelle deinen Becher",create_cup_subtitle:"Gestalte deinen Becher",create_button:"üç® START",contacts:"Unsere Standorte"}
  };

  const toggle = document.getElementById('lang-toggle');
  const menu = document.getElementById('lang-menu');

  toggle.onclick = () => menu.style.display = menu.style.display=="flex" ? "none" : "flex";

  document.addEventListener('click', e => {
    if(!e.target.closest('#lang-toggle') && !e.target.closest('#lang-menu')) menu.style.display="none";
  });

  function apply(l){
    localStorage.setItem("lang",l);
    document.querySelectorAll("[data-lang]").forEach(el => el.textContent = LANG[l][el.dataset.lang]);
    toggle.textContent = FLAGS[l] + " ‚ñæ";
  }

  const urlParams = new URLSearchParams(window.location.search);
  const urlLang = urlParams.get("lang");
  if (urlLang) localStorage.setItem("lang", urlLang);

  apply(localStorage.getItem("lang") || "it");

  document.querySelectorAll(".lang-btn").forEach(btn =>
    btn.onclick = () => apply(btn.dataset.lang)
  );

  document.getElementById("start-coppa").onclick = () => {
    window.location.href = "crea-coppa.html";
  };
})();
</script>


<script>
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("SW registrato"))
        .catch(err => console.error("SW errore:", err));
}
</script>

<script>
// Nasconde il tasto "Coppe create" se NON sei registrato
document.addEventListener("DOMContentLoaded", () => {
    const logged = localStorage.getItem("userLogged") === "1";
    const btnCrono = document.getElementById("btn-cronologia");

    if (!logged && btnCrono) {
        btnCrono.style.display = "none";
    }
});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
    const isLogged = localStorage.getItem("userLogged") === "1";
    const btn = document.getElementById("btn-disiscriviti");

    // Se NON sei registrato ‚Üí nascondi il tasto
    if (!isLogged) {
        if (btn) btn.style.display = "none";
    }
});
</script>
<script type="module">
import { supabase } from "./supabase.js";

let waitInterval = null;
let collapseTimeout = null;

function expandWaitBar() {
  const full = document.getElementById("wait-full");
  const compact = document.getElementById("wait-compact");

  if (!full || !compact) return;

  full.style.display = "inline";
  compact.style.display = "none";

  clearTimeout(collapseTimeout);
  collapseTimeout = setTimeout(collapseWaitBar, 5000);
}

function collapseWaitBar() {
  const full = document.getElementById("wait-full");
  const compact = document.getElementById("wait-compact");

  if (!full || !compact) return;

  full.style.display = "none";
  compact.style.display = "inline";
}

async function loadWaitTime() {
  const { data, error } = await supabase
    .from("wait_time")
    .select("*")
    .eq("id", 1)
    .single();

  if (error || !data) return;

  const bar = document.getElementById("wait-bar");
  const txt = document.getElementById("wait-time");

  if (!bar || !txt) return;

  // stop eventuale timer precedente
  if (waitInterval) {
    clearInterval(waitInterval);
    waitInterval = null;
  }

  if (!data.active || data.minutes <= 0) {
    bar.style.display = "none";
    return;
  }

  const startTime = new Date(data.updated_at).getTime();
  const totalSeconds = data.minutes * 60;

function tick() {
  const now = Date.now();
  const elapsed = Math.floor((now - startTime) / 1000);
  const remaining = totalSeconds - elapsed;

  if (remaining <= 0) {
    bar.style.display = "none";
    clearInterval(waitInterval);
    waitInterval = null;
    return;
  }

  const min = Math.floor(remaining / 60);
  const sec = remaining % 60;
  const timeStr = `${min}:${sec.toString().padStart(2, "0")}`;

  // üî¢ aggiorna entrambi i testi
  txt.textContent = timeStr;
  document.getElementById("wait-mmss").textContent = timeStr;

  bar.style.display = "flex";

// ‚è±Ô∏è quando inizia un nuovo minuto ‚Üí riapre la barra
if (sec === 59) {
  expandWaitBar();
}
}
  tick(); // ‚è±Ô∏è avvio immediato
  waitInterval = setInterval(tick, 1000);
}

// üî¥ REALTIME WAIT TIME
supabase
  .channel("wait-time-live")
  .on(
    "postgres_changes",
    {
      event: "*",
      schema: "public",
      table: "wait_time"
    },
    payload => {
      console.log("üîÅ wait_time aggiornato realtime:", payload);
      loadWaitTime();
    }
  )
  .subscribe();

document.addEventListener("DOMContentLoaded", loadWaitTime);
</script>



</div>



<div id="menu-overlay" style="
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.35);
  opacity:0;
  pointer-events:none;
  transition:.25s;
  z-index:10000;
"></div>

<div id="menu-dropdown" style="
  position:fixed;
  top:60px;
  left:14px;
  width:220px;
  background:#fff;
  border-radius:14px;
  box-shadow:0 12px 30px rgba(0,0,0,0.25);
  padding:10px;
  opacity:0;
  pointer-events:none;
  transform:translateY(-10px);
  transition:.25s;
  z-index:10002;
">
<a href="crea-coppa.html" class="menu-item menu-new-only">
  <span class="badge-new-left">NEW</span>
  <span>Crea Coppa</span>
</a>
<a href="home.html" class="menu-item">
  <svg class="menu-icon" viewBox="0 0 24 24" aria-hidden="true">
    <path d="M3 11.5L12 4l9 7.5" />
    <path d="M5 10.5V20a1 1 0 0 0 1 1h4v-6h4v6h4a1 1 0 0 0 1-1v-9.5" />
  </svg>
  <span>Home</span>
</a>
  <a href="menu.html" class="menu-item">
  <svg class="menu-icon" viewBox="0 0 24 24" aria-hidden="true">
    <rect x="6" y="4" width="12" height="16" rx="2"
          fill="none" stroke="currentColor" stroke-width="2"/>
    <line x1="9" y1="9" x2="15" y2="9"
          stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    <line x1="9" y1="13" x2="15" y2="13"
          stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    <line x1="9" y1="17" x2="13" y2="17"
          stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
  </svg>
  <span>Menu</span>
</a>
<a href="profilo.html" class="menu-item">
  <svg class="menu-icon" viewBox="0 0 24 24" aria-hidden="true">
    <path d="M12 12c2.761 0 5-2.239 5-5S14.761 2 12 2 7 4.239 7 7s2.239 5 5 5zm0 2c-4.418 0-8 2.239-8 5v1h16v-1c0-2.761-3.582-5-8-5z"/>
  </svg>
  <span>Profilo</span>
</a>
<a href="info-contatti.html" class="menu-item">
  <svg class="menu-icon" viewBox="0 0 24 24" aria-hidden="true">
    <!-- CERCHIO -->
    <circle
      cx="12"
      cy="12"
      r="9"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
    />

    <!-- PALLINO DELLA i -->
    <circle
      cx="12"
      cy="8"
      r="0.5"
      fill="currentColor"
    />

    <!-- STELO DELLA i -->
    <line
      x1="12"
      y1="11"
      x2="12"
      y2="17"
      stroke="currentColor"
      stroke-width="2.2"
      stroke-linecap="round"
    />
  </svg>
  <span>Info &amp; Contatti</span>
</a>
<a href="lavora-con-noi.html" class="menu-item">
  <svg class="menu-icon" viewBox="0 0 24 24" aria-hidden="true">
    <!-- corpo valigetta -->
    <rect x="3" y="7" width="18" height="13" rx="2"
          fill="none" stroke="currentColor" stroke-width="2"/>
    <!-- manico -->
    <path d="M9 7V5a3 3 0 0 1 6 0v2"
          fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round"/>
  </svg>
  <span>Lavora con noi</span>
</a>
</div>

<script>
  const menuBtn = document.getElementById("menu-btn");
  const menu = document.getElementById("menu-dropdown");
  const overlay = document.getElementById("menu-overlay");

  function openMenu(){
    menu.classList.add("open");
    menu.style.opacity = "1";
    menu.style.pointerEvents = "auto";
    menu.style.transform = "translateY(0)";

    overlay.style.opacity = "1";
    overlay.style.pointerEvents = "auto";
  }

  function closeMenu(){
    menu.classList.remove("open");
    menu.style.opacity = "0";
    menu.style.pointerEvents = "none";
    menu.style.transform = "translateY(-10px)";

    overlay.style.opacity = "0";
    overlay.style.pointerEvents = "none";
  }

  menuBtn.addEventListener("click", () => {
    const isOpen = menu.classList.contains("open");
    isOpen ? closeMenu() : openMenu();
  });

  overlay.addEventListener("click", closeMenu);

  // chiude con ESC
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closeMenu();
  });

  // chiude quando clicchi un link del menu
  menu.querySelectorAll("a").forEach(a => {
    a.addEventListener("click", closeMenu);
  });
</script>

<footer class="profile-footer">
  <div class="footer-links">
    <a href="privacy.html">Privacy</a> ¬∑
    <a href="termini.html">Termini</a> ¬∑
    <a href="cookie.html">Cookie</a>
  </div>

  <div class="footer-copy">
    ¬© 2026 Casa del Gelato
  </div>

  <div class="footer-version">
    Versione 1.0.0
  </div>
</footer>

</body>
</html>