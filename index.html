<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <title>Casa del Gelato</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="icon" href="favicon.png">
  <link rel="apple-touch-icon" href="icon-192.png">

  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;margin:0;background:#f6f6f7;color:#111}
    header{text-align:center;padding:22px}

    /* ‚úÖ HOME BUTTON */
    #home-btn {
      position:fixed;
      top:14px; left:14px;
      font-size:26px;
      text-decoration:none;
      z-index:9999;
      background:white;
      padding:6px 10px;
      border-radius:12px;
      border:1px solid #ccc;
    }

    /* ‚úÖ LANGUAGE MENU */
    #lang-toggle{
      position:fixed; top:14px; right:14px;
      padding:6px 12px;
      border-radius:12px;
      background:white;
      border:1px solid #ddd;
      cursor:pointer; 
      font-size:18px;
      z-index:10000;
    }
    #lang-menu{
      position:fixed; top:50px; right:14px;
      background:#fff;
      padding:6px 0;
      border-radius:10px;
      box-shadow:0 6px 20px rgba(0,0,0,0.12);
      display:none;
      z-index:10001;
    }
    #lang-menu button{
      padding:10px 16px;
      border:none;
      background:transparent;
      cursor:pointer;
      font-size:15px;
      text-align:left;
      width:100%;
    }
    #lang-menu button:hover{background:#f2f2f2;}

    /* BUTTONS */
    .menu-section{padding:22px;text-align:center}
    .btn{
      display:block;width:240px;text-align:center;
      padding:12px 14px;border-radius:12px;background:#ff7a00;color:#fff;
      text-decoration:none;margin:14px auto;font-size:17px;font-weight:600;
    }

    /* CARDS */
    .shop-card {
      background:white;
      padding:16px;
      border-radius:14px;
      margin:14px auto;
      max-width:330px;
      box-shadow:0 2px 6px rgba(0,0,0,0.08);
      text-align:left;
    }
    .shop-card b {font-size:16px;margin-bottom:4px;display:block;}
    .shop-card a {text-decoration:none;margin-top:4px;display:block;font-size:15px;color:#007aff;}

    /* WHATSAPP */
    #whatsapp-btn {
      position:fixed;
      right:18px;
      bottom:18px;
      background:#25D366;
      color:white;
      padding:14px 18px;
      border-radius:50%;
      font-size:24px;
      text-decoration:none;
      z-index:9999;
      box-shadow:0 4px 14px rgba(0,0,0,0.25);
    }
  </style>
</head>

<body>

<!-- LANGUAGE -->
<div id="lang-toggle">üáÆüáπ ‚ñæ</div>
<div id="lang-menu">
  <button class="lang-btn" data-lang="it">Italiano</button>
  <button class="lang-btn" data-lang="en">English</button>
  <button class="lang-btn" data-lang="de">Deutsch</button>
</div>

<header><h1 data-lang="title">Casa del Gelato</h1></header>

<section class="menu-section">
  <h2 data-lang="create_cup_title">Crea la tua Coppa</h2>
  <p data-lang="create_cup_subtitle">Personalizza la tua coppa come la vuoi tu</p>
  <a id="start-coppa" class="btn" data-lang="create_button">üç® INIZIA</a>
</section>

<section class="menu-section">
  <h2 data-lang="contacts">I nostri Locali</h2>

  <div class="shop-card">
    <b>Bibione - Viale delle Costellazioni 49</b>
    <a href="tel:043143628">üìû 0431 43628</a>
    <a href="https://goo.gl/maps/PLxK1tzJq7E2" target="_blank">üó∫ Apri su Maps</a>
  </div>

  <div class="shop-card">
    <b>Bibione - Viale delle Costellazioni 10</b>
    <a href="tel:0431364365">üìû 0431 364365</a>
    <a href="https://goo.gl/maps/hJkYB1sXcQt" target="_blank">üó∫ Apri su Maps</a>
  </div>

  <div class="shop-card">
    <b>Lignano Sabbiadoro - Via Udine 1</b>
    <a href="tel:04311961783">üìû 0431 1961783</a>
    <a href="https://goo.gl/maps/Z4q8C2e6SuM2" target="_blank">üó∫ Apri su Maps</a>
  </div>
</section>

<!-- WHATSAPP -->
<a id="whatsapp-btn" href="https://wa.me/393403788846" target="_blank">üí¨</a>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAEO7AonQeZ9SsgXd1Ymw2NZW-Pg4mI8E8",
    authDomain: "casadelgelato-db282.firebaseapp.com",
    projectId: "casadelgelato-db282",
    storageBucket: "casadelgelato-db282.firebasestorage.app",
    messagingSenderId: "121009770190",
    appId: "1:121009770190:web:81b82b82cc9bdb686cca9f"
  };

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();
</script>

<!-- LANGUAGE LOGIC -->
<script>
(function(){
  const FLAGS = { it:"üáÆüáπ", en:"üá¨üáß", de:"üá©üá™" };
  const LANG = {
    it:{title:"Casa del Gelato",create_cup_title:"Crea la tua Coppa",create_cup_subtitle:"Personalizza la tua coppa come la vuoi tu",create_button:"üç® INIZIA",contacts:"I nostri Locali"},
    en:{title:"House of Gelato",create_cup_title:"Create Your Cup",create_cup_subtitle:"Customize your cup",create_button:"üç® START",contacts:"Our Shops"},
    de:{title:"Haus des Gelatos",create_cup_title:"Erstelle deinen Becher",create_cup_subtitle:"Gestalte deinen Becher",create_button:"üç® START",contacts:"Unsere Standorte"}
  };

  const toggle = document.getElementById('lang-toggle');
  const menu = document.getElementById('lang-menu');

  toggle.onclick = () => menu.style.display = menu.style.display=="flex" ? "none" : "flex";

  document.addEventListener('click', e => {
    if(!e.target.closest('#lang-toggle') && !e.target.closest('#lang-menu')) menu.style.display="none";
  });

  function apply(l){
    localStorage.setItem("lang",l);
    document.querySelectorAll("[data-lang]").forEach(el => el.textContent = LANG[l][el.dataset.lang]);
    toggle.textContent = FLAGS[l] + " ‚ñæ";
  }
  // üî• Se arrivo da email di login ‚Üí prendo la lingua da ?lang=xx
const urlParams = new URLSearchParams(window.location.search);
const urlLang = urlParams.get("lang");

if (urlLang) {
    localStorage.setItem("lang", urlLang);
}
  apply(localStorage.getItem("lang") || "it");

  document.querySelectorAll(".lang-btn").forEach(btn =>
    btn.onclick = () => apply(btn.dataset.lang)
  );

  document.getElementById("start-coppa").onclick = () => {
    window.location.href = "crea-coppa.html";
  };
})();
</script>

<!-- üî• Firebase: Gestione link sign-in email -->
<script>
document.addEventListener("DOMContentLoaded", async () => {
    if (auth.isSignInWithEmailLink(window.location.href)) {

        let email = window.localStorage.getItem("emailForSignIn");
        if (!email) email = prompt("Inserisci la tua email per completare il login:");

        try {
            await auth.signInWithEmailLink(email, window.location.href);
            window.localStorage.removeItem("emailForSignIn");

            alert("üéâ Registrazione completata! Hai sbloccato la Cronologia Coppe.");
            localStorage.setItem("userLogged", "1");

            window.location.href = "index.html";

        } catch (err) {
            console.error(err);
            alert("Errore: " + err.message);
        }
    }
});
</script>

</body>
</html>